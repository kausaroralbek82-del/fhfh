(function(g){var window=this;'use strict';var sZ_=function(a){const l=new g.kv("und",new g.lp("Default","und",!0));l.captionTracks=a.captionTracks;return l},nhE=function(a){return new g.ws(function(l,B){let u=a.length;
const V=[];if(u){var b=function(e,M){u--;V[e]=M;u==0&&l(V)},Q=function(e){B(e)};
for(let e=0;e<a.length;e++){var n=a[e];g.gs(n,g.ir(b,e),Q)}}else l(V)})},KF=function(a){return g.nM((0,g.Rze)(),a)},edv=function({type:a,
payload:l}){a={type:a};l!==void 0&&(a.payload=l);return a},Nw=function(a){a=a.key||a.id;
if(!a)throw Error("Entity key is missing");return a},Mdn=function(){if(fF)return fF();
fF=g.Nv("PersistentEntityStoreDb",{n1:{EntityStore:{Ux:1},EntityAssociationStore:{Ux:2}},shared:!1,upgrade(a,l){l(1)&&g.B5(g.ad(a,"EntityStore",{keyPath:"key"}),"entityType","entityType");l(2)&&(a=g.ad(a,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.B5(a,"byParentEntityKey","parentEntityKey"),g.B5(a,"byChildEntityKey","childEntityKey"))},version:3});return fF()},IpD=function(a){return g.nM(Mdn(),a)},FDe=function(a){return a instanceof Error?new LF("UNKNOWN_ENCODE_ERROR",
{originalMessage:a.message}):new LF("UNKNOWN_ENCODE_ERROR")},rQE=function(a){return a instanceof Error?new LF("UNKNOWN_DECODE_ERROR",{originalMessage:a.message}):new LF("UNKNOWN_DECODE_ERROR")},Yyo=function(a,l){a=a instanceof LF?a:l(a);
g.w(a);throw a;},vhe=function(a,l,B){try{return a.K(l,B)}catch(u){Yyo(u,FDe)}},P7=function(a){a=(new TextEncoder).encode(a).subarray(0,16);
const l=new Uint8Array(16);l.set(a);return l},NZv=function(a){const l=KDo[a];
if(l)return l;g.SJ(new g.UE("Entity model not found.",{entityType:a}))},c7=function(a,l){a:{a=kW(a.Z,l.version);
try{var B=a.Z(l.data,l.key);break a}catch(u){Yyo(u,rQE)}B=void 0}return B},pF=function(a,l,B){return a.J.objectStore("EntityStore").get(l).then(u=>{if(u){if(B&&u.entityType!==B)throw Error("Incorrect entity type");
return c7(a,u)}})},W7=function(a,l,B){return B?(B=B.map(u=>pF(a,u,l)),g.CJ.all(B)):a.J.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(l)).then(u=>u.map(V=>c7(a,V)))},LDr=function(a,l,B){const u=Nw(l);
return U7(a,u).then(()=>fpv(a,l,B))},As=function(a,l,B){let u=a.K[B];
u||(u=new Set,a.K[B]=u);u.add(l)},Js=function(a,l,B){const u=Nw(l),V=kW(a.Z,1),b={...l};
return a.J.objectStore("EntityStore").get(u).then(Q=>{if(Q){if(Q.entityType!==B)throw Error("Incorrect entity type");b.entityMetadata||(Q=c7(a,Q),b.entityMetadata=Q.entityMetadata)}}).then(()=>{const Q={key:u,
entityType:B,data:vhe(V,b,u),version:1};return g.CJ.all([a.J.objectStore("EntityStore").put(Q),LDr(a,b,B)])}).then(()=>{As(a,u,B);
return u})},i0=function(a,l,B){l=l.map(u=>Js(a,u,B));
return g.CJ.all(l)},kFp=function(a,l,B){if(B.has(l))return g.CJ.resolve(void 0);
B.add(l);return PVp(a,l).then(u=>a.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l)).then(()=>u)).then(u=>{let V=g.CJ.resolve(void 0);
for(const b of u)V=V.then(()=>kFp(a,b,B));
return V}).then(()=>{})},O7=function(a,l,B){if(B?.Wi){const V=new Set;
return kFp(a,l,V).then(()=>{const b=[];for(const Q of V)b.push(O7(a,Q));return g.CJ.all(b).then(()=>{})})}const u=g.iX(l).entityType;
return g.CJ.all([a.J.objectStore("EntityStore").delete(l),U7(a,l)]).then(()=>{As(a,l,u)})},U7=function(a,l){return a.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l))},TU=function(a,l){return g.Q7(a.J.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(l)},B=>g.CJ.all([B.delete(),
U7(a,B.cursor.primaryKey)]).then(()=>{As(a,B.cursor.primaryKey,l);return g.bz(B)}))},cQA=function(a,l,B,u){const V=kW(a.Z,1);
return pF(a,l,u).then(b=>{if(b){b=g.Qm(b,B);var Q={key:l,entityType:u,data:vhe(V,b,l),version:1};return g.CJ.all([a.J.objectStore("EntityStore").put(Q),LDr(a,b,u)])}}).then(()=>{As(a,l,u);
return l})},fpv=function(a,l,B){const u=Nw(l);
B=NZv(B);if(!B)return g.CJ.resolve([]);l=new B(l);a=a.J.objectStore("EntityAssociationStore");B=[];for(const V of l.Z())B.push(a.put({parentEntityKey:u,childEntityKey:V}));return g.CJ.all(B).then(V=>V.map(b=>b[1]))},PVp=function(a,l){const B=a.J.objectStore("EntityAssociationStore");
return B.index("byParentEntityKey").getAll(IDBKeyRange.only(l)).then(u=>{const V=[];for(const b of u)V.push(B.index("byChildEntityKey").getAll(b.childEntityKey));return g.CJ.all(V)}).then(u=>{const V=[];
for(const b of u)b.length===1&&V.push(b[0].childEntityKey);return V})},kW=function(a,l=0){a=a.J[l];
if(!a)throw l=new LF("INVALID_ENCODER_VERSION",{vW:l}),g.w(l),l;return a},pdp=function(a,l){for(const B of a.observers)B(l)},H7=async function(a,l,B){var u=await IpD(a.token);
let V;l=await g.RJ(u,["EntityStore","EntityAssociationStore"],l,b=>{V=new WDD(b,a.J);return B(V)});
V&&(u=V.K,Object.keys(u).length>0&&(a.channel.postMessage(u),pdp(a,u)));return l},zU=function(a,l,B){return H7(a,{mode:"readwrite",
uA:!0},u=>Js(u,l,B))},Ucv=function(a,l){return H7(a,{mode:"readwrite",
uA:!0},B=>i0(B,l,"offlineOrchestrationActionWrapperEntity"))},DR=function(a,l){return H7(a,{mode:"readwrite",
uA:!0},B=>O7(B,l))},AQv=function(a){return H7(a,{mode:"readwrite",
uA:!0},l=>TU(l,"videoPlaybackPositionEntity"))},hs=function(a,l,B){return H7(a,{mode:"readonly",
uA:!0},u=>pF(u,l,B))},E7=function(a,l,B){return H7(a,{mode:"readonly",
uA:!0},u=>W7(u,l,B))},ORE=async function(){try{const l=await g.KM();
if(l&&g.WL()&&typeof g.Kx.BroadcastChannel!=="undefined"){var a=new JQo;return new iRr(l,a)}}catch(l){l instanceof Error&&g.w(l)}},S8=function(){oB||(oB=ORE());
return oB},TZn=function(a){a=a.options?.persistenceOption;
return a==="ENTITY_PERSISTENCE_OPTION_PERSIST"||a==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},HRu=async function(a){const l=await S8();
l&&await H7(l,"readwrite",B=>{const u={};for(const V of a){if(!V.entityKey||!TZn(V))continue;const b=g.Hr(V.payload);let Q=void 0;V.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(Q=()=>Js(B,V.payload[b],b));
V.type==="ENTITY_MUTATION_TYPE_DELETE"&&(Q=()=>O7(B,V.entityKey));
V.type==="ENTITY_MUTATION_TYPE_UPDATE"&&(Q=()=>cQA(B,V.entityKey,V.payload[b],b));
Q&&(u[V.entityKey]=u[V.entityKey]?u[V.entityKey].then(Q):Q())}return g.CJ.all(Object.values(u))})},GU=async function(a){!(a=a.mutations)||a.length<=0||(g.Q9&&g.Q9.dispatch(edv({type:"ENTITY_LOADED",
payload:a})),await HRu(a),a.length=0)},zdE=function(a){return a!==void 0},Dco=function(a){var l=g.GK();
l=Object.assign({},l);a=Object.assign({},a);for(const B in l)a[B]?(l[B]!==4&&(l[B]=a[B]),delete a[B]):l[B]!==2&&(l[B]=4);Object.assign(l,a);g.ATR(l);JSON.stringify(l);return l},hdo=async function(a){const l=await g.KM();
return l?g.RJ(await g.tP(l),["index","media","captions"],{mode:"readwrite",uA:!0},B=>{const u=IDBKeyRange.bound(a+"|",a+"~");B=[B.objectStore("index").delete(u),B.objectStore("media").delete(u),B.objectStore("captions").delete(u)];return g.CJ.all(B).then(()=>{})}):void 0},EhX=async function(){const a=await g.KM();
if(!a)throw g.$K("rvdfd");return g.RJ(await g.tP(a),["index","media"],{mode:"readwrite",uA:!0},l=>{const B={};return g.V7(l.objectStore("index"),{},u=>{var V=u.cursor.key.match(/^([\w\-_]+)\|(a|v)$/);let b=g.CJ.resolve(void 0);if(V){const Q=V[1];V=V[2];B[Q]=B[Q]||{};B[Q][V]=g.T6q(u.getValue()?.fmts)}else b=u.delete().then(()=>{});
return g.CJ.all([g.bz(u),b]).then(([Q])=>Q)}).then(()=>{const u={};
for(const b of Object.keys(B)){const Q=B[b].v;u[b]=B[b].a&&Q?1:2}const V=Dco(u);return g.WJS(l.objectStore("media"),{},b=>{const Q=b.cursor.key.match(g.hh4);Q&&u[Q[1]]||l.objectStore("media").delete(b.cursor.key);return g.KJr(b)}).then(()=>V)})})},ohe=async function(a,l){var B=await g.KM();
if(!B)throw g.$K("wct");B=await g.tP(B);await g.RJ(B,["captions"],{mode:"readwrite",uA:!0},u=>{const V=[];u=u.objectStore("captions");for(let b=0;b<l.length;b++){const Q=u.put(l[b],a+"|"+l[b].metadata.vss_id);V.push(Q)}return g.CJ.all(V)})},Syu=async function(a){a=IDBKeyRange.bound(a+"|",a+"~");
const l=await g.KM();if(!l)throw g.$K("gactfv");return(await g.tP(l)).getAll("captions",a)},GFD=async function(a){g.jK(a,0);
return hdo(a)},XdN=function(a){return{context:g.YS(),
videoIds:a}},jZn=function(a){return{context:g.YS(),
playlistIds:a}},tdn=function(a){return{context:g.YS(),
offlinePlaylistSyncChecks:a}},mcu=function(){Xq||(Xq=new wdo);
return Xq},yQo=function(a,l){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:a},metadata:l,statusCode:void 0,csn:void 0,can:void 0}},$c_=function(a,l,B){B||(B=a.J.get("FLOW_TYPE_OFFLINE_ORCHESTRATION"),B||(B=g.pG(16),a.J.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",B)));
a={flowNonce:B,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:l.eventType};l.metadata&&(a.flowMetadata=l.metadata);l.statusCode!==void 0&&(a.flowEventStatus=l.statusCode);l.csn&&(a.csn=l.csn);l.can&&(a.can=l.can);g.cP("flowEvent",a,void 0)},CVr=async function(a){var l=await H7(a,{mode:"readonly",
uA:!0},Y=>W7(Y,"playbackData").then(N=>{var p=N.map(D=>D.transfer).filter(D=>!!D),J=N.map(D=>D.offlineVideoPolicy).filter(D=>!!D),z=N.filter(D=>!!D.key).map(D=>g.Om(g.iX(D.key).entityId,"downloadStatusEntity"));
p=W7(Y,"transfer",p);J=W7(Y,"offlineVideoPolicy",J);z=W7(Y,"downloadStatusEntity",z);const T=p.then(D=>{D=D.reduce((G,br)=>{br?.offlineVideoStreams&&G.push(...br.offlineVideoStreams);return G},[]).filter(G=>!!G);
return W7(Y,"offlineVideoStreams",D)});
return g.CJ.all([p,J,T,z]).then(([D,G,br,se])=>[N,D,G,br,se])}));
a=await H7(a,{mode:"readonly",uA:!0},Y=>W7(Y,"mainDownloadsListEntity").then(N=>N[0]?.downloads??[]));
const [B,u,V,b,Q]=l,n={},e={},M={},I={},F={};l=[];for(var r of u)r&&(n[r.key]=r);for(const Y of V)Y&&(e[Y.key]=Y);for(const Y of Q)Y&&(M[Y.key]=Y);for(const Y of b)Y&&(I[Y.key]=Y);for(const Y of a)F[Y.videoItem??""]=!0,Y.videoItem&&(r=g.iX(Y.videoItem)?.entityId??"",l.push({externalVideoId:r}));return{offlineVideos:B.filter(Y=>{if(!Y||!Y.key||!Y.offlineVideoPolicy)return!1;Y=g.iX(Y.key).entityId;Y=g.Om(Y,"downloadStatusEntity");return!(Y&&M[Y]?.downloadState==="DOWNLOAD_STATE_USER_DELETED")}).map(Y=>
{var N=n[Y.transfer];
const p=[];if(N?.offlineVideoStreams)for(var J of N.offlineVideoStreams){var z=I[J];z&&p.push(z)}J=e[Y.offlineVideoPolicy];z=Y?.playerResponseTimestamp;var T=g.iX(J.key).entityId;Y=g.Om(T,"mainVideoEntity");if(J.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var D="OFFLINE_VIDEO_STATE_DISABLED";J.expirationTimestamp&&Number(J.expirationTimestamp)<Date.now()/1E3&&(D="OFFLINE_VIDEO_STATE_EXPIRED")}else if(J.action==="OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")D="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";
else{switch(N?.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":D="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":D="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":D="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":D="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":D="OFFLINE_VIDEO_STATE_PLAYABLE";break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":D="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";
break;default:D="OFFLINE_VIDEO_STATE_UNKNOWN"}if(D==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(N?.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":D="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":D="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":D="OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}T={id:T,videoState:D};
N?.cotn&&(T.cotn=N.cotn);N?.maximumDownloadQuality&&(T.selectedVideoQuality=N?.maximumDownloadQuality);N?.lastProgressTimeMs&&(T.lastProgressTimeMs=N.lastProgressTimeMs);z&&(T.playerResponseSavedTimeMs=String(Number(z)*1E3));N=String;z=0;for(const G of p)if(G.streamsProgress)for(const br of G.streamsProgress)z+=Number(br.numBytesDownloaded??0);T.downloadedBytes=N(z);T.selectedOfflineMode=F[Y]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";J.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(T.offlinePlaybackDisabledReason=
J.offlinePlaybackDisabledReason);return T}),
additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:l}}}},xce=function(){try{let B=g.fx("ytglobal.locks_");
if(B)return B;var a;if(a=navigator){var l=navigator;a="locks"in l&&!!l.locks}if(a)return g.Kx.localStorage&&g.Kx.localStorage.getItem("noop"),B=new qyn,g.Nj("ytglobal.locks_",B),B}catch{}},j8=function(a){if(a.includes(":"))throw Error(`Invalid user cache name: ${a}`);
return`${a}:${g.pJ("CacheStorage get")}`},ZR_=async function(){return ts!==void 0?ts:ts=new Promise(async a=>{try{await wd.open("test-only"),await wd.delete("test-only")}catch(l){if(l instanceof Error&&l.name==="SecurityError"){a(!1);
return}}a("caches"in window)})},y4=async function(){if(await ZR_())return m9||(m9=new dct),m9},$W=function(a,l,B){g.SJ(new g.UE(`Woffle: ${a}`,B?{cotn:B}:""));
l instanceof Error&&g.SJ(l)},ghr=async function(a){a=await CVr(a);
g.cP("offlineStateSnapshot",a)},CF=function(a,l){g.$8(a.api,"onOfflineOperationFailure",l);
a.J?.postMessage(l)},Rde=function(a){if(!a.K&&!a.J){var l=xce();
if(l){a.K=!0;var B=g.pJ("OfflineLockManager");l.request(`${"woffle_orchestration_leader"}:${B}`,{},async()=>{try{a.Z=new g.KK,a.J=!0,a.K=!1,await a.Y(),await a.Z.promise}catch(u){a.Oh(),u instanceof Error&&(u.args=[{name:"WoLockManagerError",eL:u.name}],g.w(u))}})}}},qw=function(a){a.G&&a.A&&a.B&&a.visibility.isBackground()?a.V.O$(6E4):a.V.stop()},a8N=function(a){a.J&&(a.B=!0,qw(a))},l8t=function(a,l){a.J&&(a.A=l,qw(a))},u3_=async function(a,l,B){var u=g.II(),V=B.refreshData,b=B.isEnqueuedForExpiredStreamUrlRefetch,
Q=B.wy,n=B.offlineSourceData;
B=B.mediaCapabilities;a={entityKey:a};V&&(a.refreshData=V);b&&(a.isExpiredStreamUrlRefetch=b);Q&&(a.downloadParameters=Q);n&&(a.offlineSourceData=n);l={context:g.y9(l),signatureTimestamp:20483,videos:[a]};B&&(l.mediaCapabilities=B);V=g.Kv(Bco);try{var e=await g.Vu(u,l,V,void 0,{qj:!0})}catch(M){if(M instanceof g.t5)throw e=`GetPDE network manager error: ${M.message}`,$W(e,M),Error(e);$W("GetPDE fetch request error",M);throw Error("GetPDE fetch request error");}u=e.errorMetadata?.status;if(e)u!==void 0&&
xW(u,"PDE");else throw $W("Network request failed for PDE"),Error("Network request failed for PDE");return e},VIn=function(a,l){a.J&&(a.G=l,qw(a))},ZR=function(a){a.offlineDeleteReason=a.offlineDeleteReason??"OFFLINE_DELETE_REASON_UNKNOWN";
a.offlineModeType=a.offlineModeType??"OFFLINE_NOW";g.cP("offlineDeleteEvent",a)},dd=function(a,{videoId:l,
C_:B,offlineModeType:u}){a.encryptedVideoId=l;a.cotn=B?.cotn;a.offlineabilityFormatType=B?.maximumDownloadQuality;a.isRefresh=B?.isRefresh??!1;a.softErrorCount=B?.transferRetryCount??0;a.offlineModeType=u??"OFFLINE_NOW";(a.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&a.statusType==="UNKNOWN_STATUS_TYPE"||!a.transferStatusType&&!a.statusType)&&g.SJ(Error("Woffle unknown transfer status"));g.cP("offlineTransferStatusChanged",a)},byr=function(a,l,B,u){u={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!u};l&&B&&(l=Math.floor(l/1024).toFixed(),B=Math.floor(B/1024).toFixed(),u.alreadyDownloadedKbytes=l,u.totalFetchedKbytes=l,u.totalContentKbytes=B);dd(u,a)},Qke=function(a){dd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},a)},skp=function(a){switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
gd=function(a){return(a.actionMetadata?.retryScheduleIntervalsInSeconds?.length??0)>0},RB=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!a.entityKey},av=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!a.entityKey},lC=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!a.entityKey},nIE=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!a.entityKey},BU=async function(a,l,B,u,V=!1){const b=
g.Om(a,l),Q=g.Om(a,"downloadStatusEntity");
a=await H7(B,{mode:"readonly",uA:!0},e=>g.CJ.all([pF(e,b,l),pF(e,Q,"downloadStatusEntity")]));
const n=a.length?a[0]:void 0;if(n){let e=a.length>1?a[1]:void 0;if(e){if(e.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!V)return;e.downloadState=u}else e={key:Q,downloadState:u};g.$F(n,efv,e);await H7(B,{mode:"readwrite",uA:!0},M=>g.CJ.all([Js(M,n,l),Js(M,e,"downloadStatusEntity")]))}},uC=function(a,l){return a.actionType===l.actionType&&a.entityKey===l.entityKey},Vd=function(a,l){if(a&&a.transferState!=="TRANSFER_STATE_COMPLETE"&&a.transferState!=="TRANSFER_STATE_FAILED"){const B=g.iX(a.key).entityId;
dd({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:B,C_:a,offlineModeType:l})}},bC=function(a){if(!a||!a.thumbnails)return[];
const l=[];for(const B of a.thumbnails)B.url&&l.push(B.url);return l},Qd=async function(a,l,B=[]){if(!B.length)return[];
l=await E7(a,l);a=new Set;for(var u of l)if(l=u.id||u.key)l=g.iX(l).entityId,a.add(l);u=[];for(const V of B)B=V.offlineVideoData,B?.videoId&&!a.has(B.videoId)&&u.push(V);return u},sg=function(a,l,B){return new g.KY(a,{cotn:l,
raw_player_response:B,download_media:!0,start:Infinity,disable_watch_next:!0})},ng=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},MU=function(a){if(!a.key)throw Error("Entity key is required.");
if(!a.actionProto)throw Error("OfflineOrchestrationAction is required.");const l=g.iX(a.key),B=g.iX(a.actionProto.entityKey);return new e1(B.entityType,l.entityId,a.actionProto,a.parentActionId,a.rootActionId,a.childActionIds,a.prereqActionId,a.postreqActionIds,a.retryScheduleIndex,a.hasChildActionFailed,Number(a.enqueueTimeSec)*1E3)},Iv=function(a){return{key:g.Om(a.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:a.action,parentActionId:a.parentActionId,rootActionId:a.rootActionId,childActionIds:a.childActionIds,prereqActionId:a.prereqActionId,postreqActionIds:a.postreqActionIds,retryScheduleIndex:a.retryScheduleIndex,hasChildActionFailed:a.hasChildActionFailed,enqueueTimeSec:(a.J/1E3).toFixed()}},MI_=async function(){const a=await y4();
return a?a.delete("yt-player-local-img"):!0},Fx=async function(a){const l=await y4();
if(!l)throw Error("Cache API not supported");if(a.length){var B=await l.open("yt-player-local-img");await Promise.all(a.map(u=>B.delete(u)))}},rg=async function(a){const l=await y4();
if(!l)throw Error("Cache API not supported");a.length&&await (await l.open("yt-player-local-img")).addAll(a)},Y_=async function(a,l,B,u,V){const b=g.Om(a,"mainVideoEntity"),Q=g.Om(a,"ytMainChannelEntity"),n=g.Om(a,"transfer"),e=g.Om(a,"videoDownloadContextEntity");
var M=await H7(l,{mode:"readonly",uA:!0},D=>g.CJ.all([pF(D,b,"mainVideoEntity"),pF(D,Q,"ytMainChannelEntity"),pF(D,n,"transfer"),pF(D,e,"videoDownloadContextEntity"),W7(D,"ytMainChannelEntity"),W7(D,"offlineOrchestrationActionWrapperEntity")]));
const [I,F,r,Y,N,p]=M;if(I||F){M=I?bC(I.thumbnail):[];var J=F?await I8n(F,N):[];await Fx(M.concat(J))}const z=[],T=g.Om(a,"downloadStatusEntity");for(const D of p)M=g.iX(D.key).entityId,J=MU(D),J=g.iX(J.action.entityKey).entityId,M!==a&&J!==a||uC(B,D.actionProto)||z.push(D.key);await H7(l,{mode:"readwrite",uA:!0},D=>{const G=z.map(br=>O7(D,br));
G.push(O7(D,b,{Wi:!0}));G.push(O7(D,T,{Wi:!0}));return g.CJ.all(G)});
a=Y?.offlineModeType;V&&(ZR(V),V.offlineModeType&&(a=V.offlineModeType));Vd(r,a);CF(u,{entityKey:b,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},vU=async function(a,l,B,u){const V=g.Om(a,"mainPlaylistEntity"),b=g.Om(a,"ytMainChannelEntity");
var Q=await H7(l,{mode:"readonly",uA:!0},D=>g.CJ.all([pF(D,V,"mainPlaylistEntity"),pF(D,b,"ytMainChannelEntity"),W7(D,"mainPlaylistEntity"),W7(D,"mainDownloadsListEntity"),W7(D,"ytMainChannelEntity"),W7(D,"offlineOrchestrationActionWrapperEntity")]));
const [n,e,M,I,F,r]=Q;if(n||e){Q=n?FJp(n):[];var Y=e?await I8n(e,F):[];await Fx(Q.concat(Y))}Q=[];Y=new Map;if(n){Q=await rVp(n,M,I);for(var N of Q)Y.set(N,{videoId:N,playlistId:a,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});N=await H7(l,{mode:"readonly",uA:!0},br=>g.CJ.all([W7(br,"transfer"),W7(br,"videoDownloadContextEntity")]));
const [D,G]=N;for(var p of D)N=g.iX(p.key).entityId,(N=Y.get(N))&&p&&(N.cotn=p.cotn);for(var J of G)p=g.iX(J.key).entityId,(p=Y.get(p))&&J&&(p.offlineModeType=J.offlineModeType)}const z=[];for(const D of r)J=g.iX(D.key).entityId,p=MU(D),J!==a&&p.rootActionId!==a||uC(B,D.actionProto)||z.push(D.key);const T=g.Om(a,"mainPlaylistEntity");await H7(l,{mode:"readwrite",uA:!0},D=>{const G=z.map(br=>O7(D,br));
G.push(O7(D,T,{Wi:!0}));return g.CJ.all(G)});
if(n&&(Q.reverse(),Q))for(const D of Q)await Y_(D,l,B,u,Y.get(D))},Kg=async function(a,l,B,u){const V=g.Om("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),b=new Map;
a=await H7(a,{mode:"readwrite",uA:!0},Q=>{const n=W7(Q,"transfer"),e=W7(Q,"offlineOrchestrationActionWrapperEntity"),M=W7(Q,"videoDownloadContextEntity"),I=pF(Q,V,"mainDownloadsListEntity");return g.CJ.all([n,e,M,I]).then(([F,r,Y,N])=>{const p=YAo.map(J=>TU(Q,J));
for(const J of r)uC(l,J.actionProto)||p.push(O7(Q,J.key,{Wi:!0}));N&&(N.downloads=[],p.push(Js(Q,N,"mainDownloadsListEntity")));if(Y)for(const J of Y)r=g.iX(J.key).entityId,r=g.Om(r,"transfer"),b.set(r,J.offlineModeType);return g.CJ.all(p).then(()=>F)})});
for(const Q of a){Vd(Q,b.get(Q.key));a=g.iX(Q.key).entityId;const n={videoId:a,offlineDeleteReason:u,cotn:Q.cotn,offlineModeType:b.get(Q.key)};ZR(n);a=g.Om(a,"mainVideoEntity");CF(B,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})}await MI_()},FJp=function(a,l){let B=[];
if(a.thumbnailStyleData)for(const u of a.thumbnailStyleData)B=B.concat(bC(u?.value?.collageThumbnail?.coverThumbnail));a=bC(l);return B.concat(a)},rVp=async function(a,l,B){const u=[],V=new Set;
if(B.length)for(var b of B)if(b.downloads?.length)for(const Q of b.downloads)Q.videoItem&&(B=g.iX(Q.videoItem).entityId,V.add(B));if(a.videos){for(const Q of a.videos)b=JSON.parse(g.iX(Q).entityId),b.videoId&&!V.has(b.videoId)&&u.push(b.videoId);for(const Q of l)if(Q.key!==a.key&&(l=Q.videos))for(const n of l)l=JSON.parse(g.iX(n).entityId),l.videoId&&(l=u.indexOf(l.videoId),l!==-1&&u.splice(l,1))}return u},I8n=async function(a,l){const B=bC(a.avatar);
for(const u of l)if(u.id!==a.id)for(const V of bC(u.avatar))l=B.indexOf(V),l!==-1&&B.splice(l,1);return B},vIe=async function(a){const l=g.S(a.frameworkUpdates,NU);
a.frameworkUpdates&&l&&await GU(l)},f8D=function(a){if(a.onResponseReceivedActions?.length&&(a=g.S(g.S(a.onResponseReceivedActions[0],KJ_),NcX)?.actions,a?.length))return a},LJX=async function(a){if(!a)return[];
a=await hs(a,fg,"mainDownloadsListEntity");return a?.downloads?.length?a.downloads.map(l=>l.videoItem??""):[]},Lg=async function(a,l){const B=await PUv(a,l);
B&&await H7(a,{mode:"readwrite",uA:!0},u=>{const V=[Js(u,B.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];B.mainDownloadsListEntity&&V.push(Js(u,B.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.CJ.all(V)})},PUv=async function(a,l){const B=g.Om("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.Om("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
a=await H7(a,{mode:"readonly",uA:!0},e=>g.CJ.all([pF(e,B,"mainDownloadsLibraryEntity"),pF(e,u,"mainDownloadsListEntity")]));
let [V,b]=a;a=V;let Q=b;a||(a={id:B});for(const e of l)if(e===fg){if(a.smartDownloadsList)return;a.smartDownloadsList=e}else{var n=g.iX(e).entityType;l={};n==="mainPlaylistEntity"?l.playlistItem=e:n==="mainVideoEntity"&&(l.videoItem=e);if(!g.jE(l)){if(Q?.downloads){n=!1;for(const M of Q.downloads)if(M.playlistItem===e||M.videoItem===e){n=!0;break}n||Q.downloads.push(l)}else Q={id:u,downloads:[l]};a.downloadsList=u}}return{mainDownloadsLibraryEntity:a,mainDownloadsListEntity:Q}},PU=async function(a,
l){const B=g.Om("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.Om("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
var V=await H7(a,{mode:"readonly",uA:!0},e=>g.CJ.all([pF(e,B,"mainDownloadsLibraryEntity"),pF(e,u,"mainDownloadsListEntity"),pF(e,fg,"mainDownloadsListEntity")]));
const [b,Q,n]=V;if(b){if(l===fg&&n?.downloads)n.downloads=[];else if(Q?.downloads){V=g.iX(l).entityType;for(let e=0;e<Q.downloads.length;e++){const M=Q.downloads[e];if(V==="mainVideoEntity"&&M.videoItem===l){Q.downloads.splice(e,1);break}else if(V==="mainPlaylistEntity"&&M.playlistItem===l){Q.downloads.splice(e,1);break}}}await H7(a,{mode:"readwrite",uA:!0},e=>{const M=[Js(e,b,"mainDownloadsLibraryEntity")];Q&&M.push(Js(e,Q,"mainDownloadsListEntity"));n&&M.push(Js(e,n,"mainDownloadsListEntity"));
return g.CJ.all(M)})}},k_=async function(a,l){const B=g.Om(l,"transfer"),u=g.Om(l,"videoDownloadContextEntity");
a=await H7(a,{mode:"readonly",uA:!0},Q=>g.CJ.all([pF(Q,B,"transfer"),pF(Q,u,"videoDownloadContextEntity")]));
const [V,b]=a;return{videoId:l,cotn:V?.cotn,offlineModeType:b?.offlineModeType}},cU=async function(a,l,B,u,V){const b=g.Om(a,"musicTrack"),Q=g.Om(a,"transfer");
var n=await H7(l,{mode:"readonly",uA:!0},N=>g.CJ.all([pF(N,b,"musicTrack"),pF(N,Q,"transfer"),W7(N,"musicTrack"),W7(N,"offlineOrchestrationActionWrapperEntity")]));
const [e,M,I,F]=n;e&&(n=await ktE(e,I),await Fx(n));const r=[];for(const N of F){n=g.iX(N.key).entityId;var Y=MU(N);Y=g.iX(Y.action.entityKey).entityId;n!==a&&Y!==a||uC(B,N.actionProto)||r.push(N.key)}await H7(l,{mode:"readwrite",uA:!0},N=>{const p=r.map(J=>O7(N,J));
p.push(O7(N,b,{Wi:!0}));return g.CJ.all(p)});
Vd(M);V&&ZR(V);CF(u,{entityKey:b,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},pg=async function(a,l,B,u,V){const b=g.Om(a,l),Q=g.Om("music_downloads_library_id","musicDownloadsLibraryEntity");
var n=await H7(B,{mode:"readonly",uA:!0},z=>g.CJ.all([pF(z,b,l),pF(z,Q,"musicDownloadsLibraryEntity"),W7(z,l),W7(z,"offlineOrchestrationActionWrapperEntity")]));
const [e,M,I,F]=n;e&&(n=await ktE(e,I),await Fx(n));let r=[];n=new Map;if(e){r=await cVu(e,I,M);for(var Y of r){const z=g.iX(Y).entityId;n.set(z,{videoId:z,playlistId:a,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"})}Y=await E7(B,"transfer");for(var N of Y)Y=g.iX(N.key).entityId,(Y=n.get(Y))&&N&&(Y.cotn=N.cotn)}const p=[];for(const z of F)N=g.iX(z.key).entityId,Y=MU(z),N!==a&&Y.rootActionId!==a||uC(u,z.actionProto)||p.push(z.key);const J=g.Om(a,l);await H7(B,{mode:"readwrite",uA:!0},
z=>{const T=p.map(D=>O7(z,D));
T.push(O7(z,J,{Wi:!0}));return g.CJ.all(T)});
if(e&&(r.reverse(),r.length))for(const z of r)(a=g.iX(z).entityId)&&await cU(a,B,u,V,n.get(a))},WU=async function(a,l,B){a=await H7(a,{mode:"readwrite",
uA:!0},u=>{const V=W7(u,"transfer"),b=W7(u,"offlineOrchestrationActionWrapperEntity");return g.CJ.all([V,b]).then(([Q,n])=>{const e=pHu.map(M=>TU(u,M));
for(const M of n){n=g.iX(M.actionProto.entityKey).entityType==="musicTrack";const I=M.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";uC(l,M.actionProto)||n&&(!n||I)||e.push(O7(u,M.key,{Wi:!0}))}return g.CJ.all(e).then(()=>Q)})});
for(const u of a)Vd(u),a=g.iX(u.key).entityId,ZR({videoId:a,offlineDeleteReason:void 0,cotn:u.cotn}),a=g.Om(a,"musicTrack"),CF(B,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});await MI_()},WJv=function(a){let l;
for(const B of a.additionalMetadatas)B.offlineMusicVideoData&&(l=B.offlineMusicVideoData);return{id:g.Om(a.videoId,"musicTrack"),videoId:a.videoId,title:a.title,thumbnailDetails:a.thumbnail,lengthMs:String(Number(a.lengthSeconds)*1E3),albumTitle:l?.releaseTitle,musicVideoType:l?.musicVideoType,contentRating:{explicitType:l?.explicitType},artistNames:l?.byline||l?.channelName,downloadMetadata:g.Om(a.videoId,"musicTrackDownloadMetadataEntity")}},cVu=async function(a,l,B){const u=[],V=new Set;
if(B?.downloadedTracks?.length)for(const b of B.downloadedTracks)V.add(b);if(a.tracks){for(const b of a.tracks)V.has(b)||u.push(b);for(const b of l)if(b.id!==a.id&&(l=b.tracks))for(const Q of l)l=u.indexOf(Q),l!==-1&&u.splice(l,1)}return u},ktE=async function(a,l){const B=bC(a.thumbnailDetails);
for(const u of l)if(u.id!==a.id)for(const V of bC(u.thumbnailDetails))l=B.indexOf(V),l!==-1&&B.splice(l,1);return B},Ug=async function(a,l){var B=g.Om("music_downloads_library_id","musicDownloadsLibraryEntity");
let u=await hs(a,B,"musicDownloadsLibraryEntity");u||(u={id:B});B=g.iX(l).entityType;B==="musicTrack"?u.downloadedTracks?.includes(l)||(u.downloadedTracks=(u.downloadedTracks??[]).concat(l)):B==="musicPlaylist"?u.downloadedPlaylists?.includes(l)||(u.downloadedPlaylists=(u.downloadedPlaylists??[]).concat(l)):B!=="musicAlbumRelease"||u.downloadedAlbumReleases?.includes(l)||(u.downloadedAlbumReleases=(u.downloadedAlbumReleases??[]).concat(l));await zU(a,u,"musicDownloadsLibraryEntity")},AI=async function(a,
l){var B=g.Om("music_downloads_library_id","musicDownloadsLibraryEntity");
if(B=await hs(a,B,"musicDownloadsLibraryEntity")){var u=g.iX(l).entityType;let V;u==="musicTrack"?V=B.downloadedTracks:u==="musicPlaylist"&&(V=B.downloadedPlaylists);if(V?.length)for(u=0;u<V.length;u++)if(V[u]===l){V.splice(u,1);break}await zU(a,B,"musicDownloadsLibraryEntity")}},U5r=function(a){var l=a.videos;
a=[];const B=[];if(l)for(const V of l){var u=V.offlineVideoData.videoId;l=g.Om(u,"musicTrack");u=g.Om(u,"musicTrackDownloadMetadataEntity");a.push(l);B.push(u)}return{lD:a,HG:B}},JI=function(a,l,B){l={track:WJv(l)};
B&&(l.playlistId=B);if(a=g.S(a.actionMetadata,AVe))l.maximumDownloadQuality=a.maximumDownloadQuality;return{musicTrackEntityActionMetadata:l}},iyo=async function(a){var l=g.II();
a=XdN(a);const B=g.Kv(JVp);try{var u=await g.Vu(l,a,B,void 0,{qj:!0})}catch(V){if(V instanceof g.t5)throw u=`GetOffline network manager error: ${V.message}`,$W(u,V),Error(u);$W("GetOffline fetch request error",V);throw Error("GetOffline fetch request error");}l=u.errorMetadata?.status;if(!u)throw $W("Network request failed"),Error("Network request failed");if(l!==void 0)xW(l);else if(!u.videos||!u.videos.length)throw $W("No data"),Error("No data");return u.videos.map(V=>V.offlineVideoData)},iC=async function(a){var l=
g.II();
a=jZn(a);const B=g.Kv(JVp);try{var u=await g.Vu(l,a,B,void 0,{qj:!0})}catch(V){if(V instanceof g.t5)throw u=`GetOffline network manager error for playlist: ${V.message}`,$W(u,V),Error(u);$W("GetOffline fetch request error for playlist",V);throw Error("GetOffline fetch request error for playlist");}l=u.errorMetadata?.status;if(!u)throw $W("Network request failed for playlist"),Error("Network request failed for playlist");if(l!==void 0)xW(l,"playlist");else if(!u.playlists||!u.playlists.length)throw $W("No data for playlist"),
Error("No data for playlist");return u.playlists.map(V=>V.offlinePlaylistData)},Tcv=async function(a,l,B,u){const V=await S8();
if(!V)return[];var b=[];u?.length?b=u:b=await E7(V,"mainPlaylistEntity");if(!b.length)return[];u=[];const Q=Date.now()/1E3;for(const I of b){var n=I.downloadState?await hs(V,I.downloadState,"mainPlaylistDownloadStateEntity"):void 0,e=(b=I?.entityMetadata)&&b.nextAutoRefreshIntervalSeconds?Number(b.nextAutoRefreshIntervalSeconds):NaN;e=Number.isNaN(e)?a:e;var M=n?.lastSyncedTimestampMillis?Number(n?.lastSyncedTimestampMillis)/1E3:0;n=n?.addedTimestampMillis?Number(n?.addedTimestampMillis)/1E3:0;if(B||
!b||M+e<=Q){e=[];if(I.videos?.length)for(const F of I.videos)M=JSON.parse(g.iX(F).entityId),M.videoId&&e.push(M.videoId);M="0";b&&(M=String(Number(b.offlineLastModifiedTimestampSeconds??0).toFixed()));u.push({playlistId:I.playlistId,videoIds:e,offlineLastModifiedTimestamp:M,autoSync:l,offlineDateAddedTimestamp:String(n.toFixed())})}}return u.length?await Oyr(u):[]},HyE=async function(){var a=await S8();
if(!a)return!1;a=await E7(a,"refresh");if(!a[0]?.refreshTime)return!1;a=Number(a[0].refreshTime);const l=Date.now()/1E3;return isFinite(a)&&l>=a},D5E=async function(a,l){let B;
try{const u=await zfv(a,l);await vIe(u);B=f8D(u)}catch(u){$W("getAndProcessSmartDownloadsResponse request or processing error",u)}return B},hfD=async function(a,l,B,u){const V=await S8();
if(!V)return[];var b=[];u?.length?b=u:b=await E7(V,"musicPlaylist");if(!b.length)return[];u=[];const Q=Date.now()/1E3;for(const M of b){var n=(b=M?.entityMetadata)&&b.nextAutoRefreshIntervalSeconds?Number(b.nextAutoRefreshIntervalSeconds):NaN;const I=Number.isNaN(n)?a:n;let F=n=0;var e="DOWNLOAD_SYNC_STATE_UNKNOWN";M.downloadMetadata&&(e=await hs(V,M.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),n=Number(e?.addedTimestampMillis??"0")/1E3,F=Number(e?.lastModifiedTimestampMillis??"0")/1E3,
e=e?.syncState??"DOWNLOAD_SYNC_STATE_UNKNOWN");if(B||e!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||!b||Number(b.lastSyncedTimestampSeconds??0)+I<=Q){b=[];if(M.tracks?.length)for(const r of M.tracks)b.push(g.iX(r).entityId);u.push({playlistId:M.playlistId,videoIds:b,offlineLastModifiedTimestamp:String(F.toFixed()),autoSync:l,offlineDateAddedTimestamp:String(n.toFixed())})}}return u.length?await Oyr(u):[]},zfv=async function(a,l){var B=g.II(),u=await S8();
let V;u&&(V=await CVr(u));u=V;a={context:g.YS(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:a},offlineClientState:u,clientStateRequestData:{preferredFormatType:l}}}};l=g.Kv(EIp);try{var b=await g.Vu(B,a,l,void 0,{qj:!0})}catch(Q){if(Q instanceof g.t5)throw b=`DPS network manager error for smart downloads: ${Q.message}`,$W(b,Q),Error(b);$W("DPS fetch request error for smart downloads",Q);throw Error("DPS fetch request error for smart downloads");
}B=b.errorMetadata?.status;if(b)B!==void 0&&xW(B,"smart downloads");else throw $W("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return b},SAo=async function(a,l){var B=g.II();
a={context:g.YS(),videoPlaybackPositionEntities:a,lastSyncTimestampUsec:l};l=g.Kv(oI_);try{var u=await g.Vu(B,a,l,void 0,{qj:!0})}catch(V){if(V instanceof g.t5)throw u=`VPPS network manager error: ${V.message}`,$W(u,V),Error(u);$W("VPPS fetch request error",V);throw Error("VPPS fetch request error");}B=u.errorMetadata?.status;if(u)B!==void 0&&xW(B,"position sync");else throw $W("Network request failed for position sync"),Error("Network request failed for position sync");return u},xW=function(a,l){l=
l?` for ${l}`:"";
if(a===0)throw a=`Empty response body${l}`,$W(a),Error(a);a=`Response with error${l}`;$W(a);throw Error(a);},Oyr=async function(a){var l=g.II();
a=tdn(a);const B=g.Kv(Gto);try{var u=await g.Vu(l,a,B,void 0,{qj:!0})}catch(V){if(V instanceof g.t5)throw u=`offlinePlaylistSyncCheck network manager error: ${V.message}`,$W(u,V),Error(u);$W("offlinePlaylistSyncCheck fetch request error",V);throw Error("offlinePlaylistSyncCheck fetch request error");}l=u.errorMetadata?.status;if(!u)throw $W("Network request failed for playlist sync"),Error("Network request failed for playlist sync");if(l!==void 0)xW(l,"playlist sync");else if(!u.offlinePlaylistSyncCheckDatas||
!u.offlinePlaylistSyncCheckDatas.length)throw $W("No data for playlist sync"),Error("No data for playlist sync");return u.offlinePlaylistSyncCheckDatas.map(V=>V.offlinePlaylistSyncCheckData)},XHp=async function(a,l){const B=new Map;
for(const u of l)B.set(u,await a.Z(u));return B},Og=function(a,l,B,u,V,b){l=g.Om(l,B);
return{actionType:a,entityKey:l,actionMetadata:{...b,priority:u,retryScheduleIntervalsInSeconds:V}}},wHD=async function(a,l){var B=l.entityKey;
const u=g.S(l.actionMetadata,Ti)?.isEnqueuedForExpiredStreamUrlRefetch;try{let b=void 0;b=await jkA(a,l);let Q;try{{const n=g.S(l.actionMetadata,Ti);var V=n?{maximumDownloadQuality:n.maximumDownloadQuality}:void 0}Q=await u3_(B,a.eF,{isEnqueuedForExpiredStreamUrlRefetch:u,wy:V,offlineSourceData:b})}catch(n){const e=gd(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR";$W("PDE handleAdd error");return HU(l,!1,void 0,
"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",e,"DOWNLOAD_STATE_FAILED")}await tIt(a,Q,l);return HU(l,!0,Q.orchestrationActions)}catch(b){return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.tx&&b.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),$W("PDE handleAdd error"),HU(l,!1,void 0,a,B,"DOWNLOAD_STATE_FAILED")}},
$5u=async function(a,l){const B=l.entityKey,u=g.iX(B).entityId;
var V=await H7(a.J,{mode:"readonly",uA:!0},F=>{const r=pF(F,B,"playbackData"),Y=pF(F,g.Om(u,"offlineVideoPolicy"),"offlineVideoPolicy");F=pF(F,g.Om(u,"transfer"),"transfer");return g.CJ.all([r,Y,F])});
const [b,Q,n]=V;if(!b||!Q)return HU(l,!0);V=[];var e=b?.playerResponseJson?JSON.parse(b.playerResponseJson):null;if(n&&e){var M=m5n(a,e,n);V=await yVt(a,n)}V={lastPlayerResponseTimestampSeconds:b.playerResponseTimestamp,offlineToken:Q.offlineToken,formatIds:V};e={};n?.maximumDownloadQuality&&(e.maximumDownloadQuality=n.maximumDownloadQuality);try{let F=void 0;F=await jkA(a,l);try{var I=await u3_(B,a.eF,{refreshData:V,wy:e,offlineSourceData:F,mediaCapabilities:M})}catch(r){const Y=gd(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR";$W("PDE handleRefresh error");return HU(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Y,"DOWNLOAD_STATE_FAILED")}await tIt(a,I,l);return HU(l,!0,I.orchestrationActions)}catch(F){return a="PDE handleRefresh error",F instanceof Error&&(a=`PDE handleRefresh error: ${F.message}`),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.tx&&F.type===
"QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),$W(a),HU(l,!1,void 0,M,I,"DOWNLOAD_STATE_FAILED")}},jkA=async function(a,l){l=g.iX(l.entityKey).entityId;
l=g.Om(l,"videoDownloadContextEntity");a=await hs(a.J,l,"videoDownloadContextEntity");return a?.offlineModeType?{offlineModeType:a.offlineModeType}:void 0},HU=function(a,l,B,u,V,b){return new zi(l?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",gd(a),B,u,V,b)},tIt=async function(a,l,B){if(l.frameworkUpdates&&g.S(l.frameworkUpdates,NU)){if(g.S(l.frameworkUpdates,NU).mutations&&g.S(l.frameworkUpdates,NU).mutations.length>0&&g.S(l.frameworkUpdates,NU).mutations[0].type===
"ENTITY_MUTATION_TYPE_DELETE"){const u=g.iX(g.S(l.frameworkUpdates,NU).mutations[0].entityKey).entityId,V=await k_(a.J,u),b=g.S(B.actionMetadata,Ti)?.playlistId;
b&&(V.playlistId=b);V.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";g.AT(a.eF)?await Y_(u,a.J,B,a.K,V):g.a5(a.eF)&&await cU(u,a.J,B,a.K)}await GU(g.S(l.frameworkUpdates,NU))}},m5n=function(a,l,B){l=sg(a.eF,B.cotn,l);
B=g.NP(l);return g.qot(l,B,a.eF)},yVt=async function(a,l){const B=[];
if(a=await H7(a.J,{mode:"readonly",uA:!0},u=>{const V=[],b=l.offlineVideoStreams;if(b)for(const Q of b)V.push(pF(u,Q,"offlineVideoStreams"));return g.CJ.all(V)}))for(const u of a)if(u?.streamsProgress){a=u.streamsProgress;
for(let V=0;V<a.length;V++){const b=JSON.parse(a[V].formatStreamBytes);B.push({itag:b.itag,lmt:b.lastModified,xtags:b.xtags})}}return B},CUN=async function(a,l){l=gd(l);
a=await E7(a.J,"videoPlaybackPositionEntity");if(a.length===0)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l);try{const B=await Dm.getInstance();if(!B)throw Error("prefStorage is undefined");const u=(await B.get("psi"))?.CA??"0",V=await SAo(a,u),b={isPaused:V.watchHistoryPaused,CA:V.syncTimestampUsec};await B.set("psi",b);if(!b.isPaused){const Q=g.S(V.frameworkUpdates,NU);V.frameworkUpdates&&Q&&await GU(Q)}}catch(B){return $W("PPE handleRefresh error: "+(B instanceof Error?B.message:
"unknown error")),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l)},x5u=async function(a,l){const B=gd(l),u=g.iX(l.entityKey).entityId;
try{const V=await Dm.getInstance();if(!V)throw Error("prefStorage is undefined");const b=await V.get("psi"),Q=g.S(l.actionMetadata,qAt);if(b?.isPaused===!1&&Q?.lastPlaybackPositionSeconds){const n={key:g.Om(u,"videoPlaybackPositionEntity"),videoId:u,lastPlaybackPositionSeconds:Q.lastPlaybackPositionSeconds};await zU(a.J,n,"videoPlaybackPositionEntity")}}catch(V){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B)},Zyv=async function(a,l){const B=gd(l);
try{const u=g.iX(l.entityKey).entityId;if(u==="!*$_ALL_ENTITIES_!*$")await AQv(a.J);else{const V=g.Om(u,"videoPlaybackPositionEntity");await DR(a.J,V)}}catch(u){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},hI=async function(a){return GFD(a)},d5p=async function(a){return(await g.HLe(a)).filter(l=>!!l.url).map(l=>
l.url)},Eg=function(a,l){var B=g.X9(l);
if(B===1||B===0)return Promise.resolve();(B=a.player?.getVideoData().videoId===l?a.player:null)&&B.stopVideo();a.K=0;return hI(l)},ov=function(a,l,B=!1,u=!0){l=typeof l==="string"?l:l.videoDetails.videoId;
if(g.X9(l)===2){var V=a.player?.getVideoData().videoId===l?a.player:null;V&&V.stopVideo();g.jK(l,2);a.K=2;B?gIN(a.J):u&&RfD(a.J)}},lev=async function(a,l){const B=gd(l);
if(await hs(a.J,l.entityKey,"transfer"))return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);try{await aeA(a,l)}catch(u){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},BUu=async function(a,l){const B=gd(l),u=await hs(a.J,l.entityKey,"transfer");
if(!u||u.transferState!=="TRANSFER_STATE_COMPLETE")return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);try{await aeA(a,l,!0)}catch(V){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},uEp=async function(a,l){const B=gd(l),u=g.iX(l.entityKey).entityId,V=await H7(a.J,{mode:"readonly",
uA:!0},n=>{const e=pF(n,l.entityKey,"transfer");n=pF(n,g.Om(u,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.CJ.all([e,n])}),[b,
Q]=V;if(!b||b.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);try{b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";await zU(a.J,b,"transfer");const n=g.iX(b.key).entityId;dd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:n,C_:b,offlineModeType:Q?.offlineModeType})}catch(n){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},aeA=async function(a,l,B=!1){const u=g.S(l.actionMetadata,VGA),V=g.iX(l.entityKey).entityId,b=g.Om(V,"downloadStatusEntity");
var Q=await H7(a.J,{mode:"readonly",uA:!0},I=>{const F=pF(I,b,"downloadStatusEntity");I=pF(I,g.Om(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.CJ.all([F,I])});
const [n,e]=Q;Q="TRANSFER_STATE_TRANSFER_IN_QUEUE";n?.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&(Q="TRANSFER_STATE_PAUSED_BY_USER");const M={key:l.entityKey,transferState:Q,cotn:g.pG(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:u?.maximumDownloadQuality,preferredAudioTrack:u?.preferredAudioTrack,transferRetryCount:0,isRefresh:B,hasLoggedFirstStarted:!1};await H7(a.J,{mode:"readwrite",uA:!0},I=>{const F=[];B&&F.push(O7(I,g.Om(V,"offlineVideoStreams")));F.push(Js(I,M,"transfer"));
return g.CJ.all(F)});
B&&await hI(V);dd({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:V,C_:M,offlineModeType:e?.offlineModeType})},QK_=function(a,l,B,u){if(!a.action.entityKey)throw Error("entityKey is missing.");
const {X2:V,entityId:b}=g.iX(a.action.entityKey),Q={entityType:V,entityId:b,offlineOrchestrationActionType:a.action.actionType,orchestrationAction:{orchestrationActionId:a.actionId}};l&&(Q.offlineOrchestrationActionResult=l.status,Q.isRetryable=B?!1:l.J,l.K&&(Q.offlineOrchestrationFailureReason=bqE(l.K,Q.isRetryable)));a.action.actionMetadata?.offlineLoggingData?.offlineModeType&&(Q.offlineModeType=a.action.actionMetadata.offlineLoggingData.offlineModeType);u&&(Q.additionalOrchestrationActions=u.map(n=>
({orchestrationActionId:n.actionId})));
return Q},bqE=function(a,l){return a!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||l?a==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&l?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":a:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},S1=function(a,l){const B={offlineOrchestrationContext:QK_(a)};
l=yQo(l,B);$c_(mcu(),l,a.rootActionId)},Gi=function(a,l,B,u=[]){l={offlineOrchestrationContext:QK_(a,l,B,u)};
l=yQo(3,l);$c_(mcu(),l,a.rootActionId)},sKv=function(a,l){for(const B of l)S1(B,1),a.actions.push(B);
a.actions.sort(a.J)},nUp=function(a,l){if(l)for(let B=0;B<a.actions.length;B++)if(l==="!*$_ALL_ENTITIES_!*$"&&a.actions[B].actionId!==l||l!=="!*$_ALL_ENTITIES_!*$"&&a.actions[B].rootActionId===l&&a.actions[B].actionId!==l)a.actions.splice(B,1),B--},eyn=function(a,l){for(const B of a.actions)if(B.actionId===l)return!0;
return!1},rgE=async function(a,l,B,u,V){a=new MGv(a,l,B,u,V);
await Iep(a);FtA(a);return a},Iep=async function(a){const l=await E7(a.Z,"offlineOrchestrationActionWrapperEntity");
await Xx(a,l)},FtA=function(a){const l=a.J.actions[0];
return a.V?(l?.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&a.V[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(a.B=!0),Promise.resolve()):YVv(a)},YVv=async function(a){if(a.V)throw Error("Already processing an action");
if(!a.HA()){var l=a.J.actions.shift();l8t(a.Zh,!l);if(l!==void 0){l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&l.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&nUp(a.J,l.actionId);var B="";l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.rootActionId===l.actionId&&(B=l.actionId);var u=[l];a.V=u;if(l=a.oJ[l.entityType]){for(const V of u)S1(V,2);try{const V=await XHp(l,u.map(b=>b.action));
for(const b of u){const Q=V.get(b.action);await vUo(a,b,Q)}nUp(a.J,B)}catch(V){$W("Orchestration error",V);try{await Kt_(a,u)}catch(b){$W("Orchestration retry error",b);for(const Q of u)Q.retryScheduleIndex<3&&sKv(a.J,[Q])}}finally{a.V=void 0}}else a.V=void 0;await YVv(a)}}},vUo=async function(a,l,B){var u=l.retryScheduleIndex+2===3;
if(B.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){var V=void 0;try{V=B.V?.map(b=>a.createAction(b,l))}catch(b){Gi(l,B,u);
CF(a.G,{entityKey:l.action.entityKey,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"});$W("Orchestration subactions creation error",b);return}Gi(l,B,u,V);if(V){const b=V.map(n=>Iv(n));
let Q=0;for(;Q<V.length&&!a.B;)await H7(a.Z,{mode:"readwrite",uA:!0},n=>{const e=[];e.push(i0(n,b.slice(Q,Q+10),"offlineOrchestrationActionWrapperEntity"));return g.CJ.all(e)}),Q+=10;
if(a.B){a.B=!1;return}}B=Iv(l);await DR(a.Z,B.key);S1(l,4)}else if(B.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE")if(Gi(l,B,u),B.J&&l.retryScheduleIndex+1<3)await Kt_(a,[l]);else{u={entityKey:l.action.entityKey,failureReason:B?.Z?B.Z:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN"};V=void 0;g.AT(a.eF)?V="mainVideoDownloadStateEntity":g.a5(a.eF)&&(V="musicTrackDownloadMetadataEntity");if(V&&B.downloadState){const b=g.iX(l.action.entityKey).entityId;await BU(b,V,a.Z,B.downloadState)}CF(a.G,u);
B.downloadState==="DOWNLOAD_STATE_FAILED"&&a.eF.W("html5_auto_retry_failed_pde_actions")||($W("Orchestration result is not retryable, deleting action"),await DR(a.Z,Iv(l).key))}},Kt_=async function(a,l){for(const B of l){const u=B.action?.actionMetadata?.retryScheduleIntervalsInSeconds||[1,
2,4];let V=1;B.retryScheduleIndex<u.length&&(V=u[B.retryScheduleIndex]);B.J=V*1E3+Date.now();B.retryScheduleIndex++}await NUE(a,l)},fee=async function(a,l){return(await E7(a.Z,"offlineOrchestrationActionWrapperEntity",l)).filter(zdE)},Xx=async function(a,l){let B=[];
var u=Infinity;let V=4E3;for(const Q of l){l=Number(Q.enqueueTimeSec);const n=Ltp(l);var b=Q.retryScheduleIndex;b=b!=null&&b>0;n>0&&b?(u=Math.min(u,l),V=Math.min(n,V)):B.push(Q)}isFinite(u)&&(!a.K.isActive()||u<a.Y)&&(a.Y=u,a.K.start(V));a.A.k8()||(u=B.length,B=B.filter(Q=>!Ple.includes(Q.actionProto?.actionType||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN")),u=B.length<u,!a.K.isActive()&&u&&a.K.start(1));
B.length>0&&kHu(a,B);await FtA(a)},Ltp=function(a){a=a*1E3-Date.now();
return a>4E3?4E3:a},kHu=function(a,l){l.length!==0&&l.forEach(B=>{B=MU(B);
B.retryScheduleIndex<3&&sKv(a.J,[B])})},cgA=async function(a){var l=await fee(a);
const B=[];for(const u of l)l=g.iX(u.key).entityId,eyn(a.J,l)||B.push(u);await Xx(a,B)},NUE=function(a,l){if(l.length===0)return Promise.resolve([]);
l=l.map(B=>Iv(B));
return Ucv(a.Z,l)},pun=async function(a,l){const B=l.videoId;
let u=!0;if(l.captionTracks.length){const V=sZ_(l);a.J=new g.PD(a.gP,l,V)}else if(l.bA)a.J=new g.k2(a.gP,l.bA,B,g.Ceu(l),l.u$,l.eventId),u=l.u$;else return;return new Promise(V=>{a.J?.B({pj:async()=>{await a.pj(B,u);V()},
A8:()=>{}})})},Wtu=async function(a){a=await Syu(a);
return!!a&&a.length>0},UOv=async function(a,l){if(l.length===0)return[];
const B=l.map(V=>g.Om(V,"transfer")),u=(await E7(a.J,"transfer",B)).filter(zdE).map(V=>g.iX(V.key).entityId);
a=l.filter(V=>u.indexOf(V)===-1);
if(a.length===0)return[];for(const V of a)await hI(V);return a},iqt=async function(a,l,B,u,V,b){let Q="STREAM_TYPE_UNKNOWN";
B.video&&B.audio?(Q="STREAM_TYPE_AUDIO_AND_VIDEO",$W("unexpected stream type")):B.video&&!B.audio?Q="STREAM_TYPE_VIDEO":!B.video&&B.audio&&(Q="STREAM_TYPE_AUDIO");const n=g.Om(l,"offlineVideoStreams"),e={numBytesDownloaded:V.toFixed(),numTotalBytes:b.toFixed(),streamType:Q,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(u),itag:Q==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(B.itag):void 0};await H7(a,{mode:"readwrite",uA:!0},M=>{const I=pF(M,n,"offlineVideoStreams"),F=pF(M,
g.Om(l,"transfer"),"transfer");return g.CJ.all([I,F]).then(([r,Y])=>{if(!Y)return O7(M,n).then(()=>{});
var N=AgD(r);r=Jgp(r,u,e,n);const p=Js(M,r,"offlineVideoStreams");AgD(r)>N&&(Y.lastProgressTimeMs=Date.now().toString());N=[p];Y.offlineVideoStreams||(Y.offlineVideoStreams=[]);Y.offlineVideoStreams.indexOf(n)===-1&&(Y.offlineVideoStreams.push(n),N.push(Js(M,Y,"transfer")));return g.CJ.all(N)})})},Oq_=async function(a,l){l=g.Om(l,"offlineVideoStreams");
if((l=await hs(a,l,"offlineVideoStreams"))&&l.streamsProgress){for(const B of l.streamsProgress)B.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",B.numTotalBytes!==B.numBytesDownloaded&&(B.numBytesDownloaded=B.numTotalBytes);await zU(a,l,"offlineVideoStreams")}},Jgp=function(a,l,B,u){if(a&&a.streamsProgress){u=a;
a:{l=`${l.itag};${l.xtags}`;var V=a.streamsProgress;for(let b=0;b<V.length;b++){const Q=JSON.parse(V[b].formatStreamBytes);if(`${Q.itag};${Q.xtags}`===l){V[b]=B;B=V;break a}}V.push(B);B=V}u.streamsProgress=B}else a={key:u,streamsProgress:[B]};return a},AgD=function(a){if(a?.streamsProgress){let l=0;
a=a.streamsProgress;for(let B=0;B<a.length;B++){const u=a[B];isNaN(Number(u.numBytesDownloaded))?$W("stream progress bytes number invalid"):l+=Number(u.numBytesDownloaded)}return l}return 0},gIN=async function(a){if(a.J){const l=a.J;
a.V.stop();await j1(a,"TRANSFER_STATE_PAUSED_BY_USER");const B=l?.key?g.iX(l.key).entityId:"";B&&a.K&&await BU(B,a.K,a.Z,"DOWNLOAD_STATE_PAUSED");const u=await tI(a,B);Qke({videoId:B,C_:l,offlineModeType:u})}else wg(a,"onTransferPausedByUser");m2(a);yd(a)},RfD=async function(a){if(a.J){a.V.stop();
await j1(a,"TRANSFER_STATE_TRANSFER_IN_QUEUE");var l=a.J;(l=l?.key?g.iX(l.key).entityId:"")&&a.K&&await BU(l,a.K,a.Z,"DOWNLOAD_STATE_PAUSED");m2(a)}else wg(a,"onTransferPausedByNetwork")},$_=async function(a){if(a.J){a.V.start(108E5);
await j1(a,"TRANSFER_STATE_TRANSFERRING");var l=a.J;(l=l?.key?g.iX(l.key).entityId:"")&&a.K&&await BU(l,a.K,a.Z,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS")}else wg(a,"onTransferStart")},TUE=async function(a,l,B){if(a.J){a.J.transferState!=="TRANSFER_STATE_TRANSFERRING"&&await $_(a);
var u=Date.now();u-a.RJ>1E3&&(a.RJ=u,await iqt(a.Z,B.videoId,B.Z,B.vC,B.bytesDownloaded,B.J),!a.C||a.C&&u-a.Zh>a.PA)&&(a.Zh=u,u=await tI(a,l),byr({videoId:l,C_:a.J,offlineModeType:u},B.bytesDownloaded,B.J));a.V.start(108E5)}else wg(a,`onTransferProgress: ${l}`)},zyo=async function(a){if(a.J){var l=a.J;
a.V.stop();if(l&&a.B){var B=sg(a.api.U(),l.cotn,a.B);await HqA(a,B)}await j1(a,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE");(B=l?.key?g.iX(l.key).entityId:"")&&a.K&&await BU(B,a.K,a.Z,"DOWNLOAD_STATE_COMPLETE");await Oq_(a.Z,B);var u=await tI(a,B);dd({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",statusType:"SUCCESS"},{videoId:B,C_:l,offlineModeType:u});m2(a);yd(a)}else wg(a,"onTransferComplete")},DOo=async function(a){await EhX();
a=a.vA;var l=g.GK();l=Object.keys(l);await UOv(a,l)},oUn=async function(a){a=(await E7(a.Z,"transfer")).filter(hyv).sort(EUv);
return a.length===0?void 0:a[0]},Xun=async function(a,l){if(!a.Y){a.Y=!0;
a.J=l;var B=g.iX(a.J.key).entityId;if(a.J.transferState==="TRANSFER_STATE_TRANSFERRING"){var u=await tI(a,B);dd({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:B,C_:a.J,offlineModeType:u})}else a.J.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||a.J.transferRetryCount||a.J.hasLoggedFirstStarted||(u=await tI(a,B),a.J.hasLoggedFirstStarted=!0,await SVo(a),byr({videoId:B,C_:a.J,offlineModeType:u},void 0,void 0,!0));await $_(a);B=null;try{B=await GHt(a,
l),a.B=B}catch(V){$W("error getting player response",V,l.cotn);await a.EK("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING");return}u=sg(a.api.U(),l.cotn,B);await HqA(a,u);u.vy=await d5p(u.videoId);B=a.G;l=l.maximumDownloadQuality;u.getPlayerResponse();g.jK(u.videoId,2);B.K=2;B.Z=!1;B.player?.dispose();B.player=B.api.E4(u);B.player.gx({localmediachange:B.sK,signatureexpired:B.Lp,statechange:B.V},B);B.W("html5_generate_content_po_token")&&B.player.um();l=B.dw(l);B.player.rE(g.nB(l,l,!0,"m"),!1);B.player.tT(!1);
a.V.start(108E5)}},m2=function(a){a.J=void 0;
a.B=void 0;a.V.stop()},yd=async function(a,l=!1){if(a.J)throw Error("Already downloading a video");
a.Zh=0;a.Y=!1;const B=await oUn(a);VIn(a.bd,!B);B&&a.A.k8()?(l&&await new Promise(u=>{g.jU(u,1E3)}),await Xun(a,B)):!B&&a.J&&m2(a)},tI=async function(a,l){return(await hs(a.Z,g.Om(l,"videoDownloadContextEntity"),"videoDownloadContextEntity"))?.offlineModeType??void 0},jKo=async function(a){a.B&&(await Eg(a.G,a.B.videoDetails.videoId),m2(a))},HqA=async function(a,l){try{(l.captionTracks.length||l.bA)&&!await Wtu(l.videoId)&&await pun(a.ud,l)}catch(B){$W("Caption downloading error",B,l.cotn)}},SVo=
async function(a,l){if(a.J){var B=a.J;
await H7(a.Z,{mode:"readwrite",uA:!0},u=>{const V=[Js(u,B,"transfer")];l&&V.push(l(u));return g.CJ.all(V)})}},GHt=async function(a,l){l=g.iX(l.key).entityId;
l=g.Om(l,"playbackData");a=await hs(a.Z,l,"playbackData");if(a?.playerResponseJson)return JSON.parse(a.playerResponseJson);throw Error("No PlayerResponse found");},j1=async function(a,l,B,u){if(a.J){a.J.transferState=l;
a.J.failureReason=u;try{await SVo(a,V=>B?W7(V,"offlineVideoStreams",a.J.offlineVideoStreams).then(b=>{for(const Q of b)if(Q&&Q.streamsProgress)for(const n of Q.streamsProgress)n.streamState=B;return i0(V,b.filter(Q=>!!Q),"offlineVideoStreams")}):g.CJ.resolve(void 0))}catch(V){V instanceof g.tx&&V.type==="QUOTA_EXCEEDED"&&await a.EK("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE")}}else wg(a,`saveTransferState: ${l}`)},wg=function(a,l){a.api.nV("woffle",{mcte:l});
$W("missing current transfer entity.")},tGt=function(a){const l=(a.J.transferRetryCount||0)<3;
l&&(a=a.J,a.transferRetryCount=(a.transferRetryCount||0)+1);return l},wu_=async function(a,l="TRANSFER_FAILURE_REASON_UNKNOWN"){a.J||wg(a,`setTransferToFailed: ${l}`);
var B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";l==="TRANSFER_FAILURE_REASON_NETWORK"?B="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":l==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED");await j1(a,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",l);CF(a.D,{entityKey:a.J?.key,failureReason:B});B=a.J?g.iX(a.J.key).entityId:"";const u=await tI(a,B);a={videoId:B,C_:a.J,offlineModeType:u};B={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",
statusType:"FAILED"};l&&(B.transferFailureReason=l,B.failureReason=skp(l));dd(B,a)},hyv=function(a){return Cg[a.transferState]!==void 0},EUv=function(a,l){const B=Cg[a.transferState],u=Cg[l.transferState];
return B!==u?B-u:Number(a.enqueuedTimestampMs)-Number(l.enqueuedTimestampMs)},mOt=async function(a){g.$8(a.api,"onOrchestrationBecameLeader");
await a.HN()},Clo=async function(a){const l=await S8();
if(l){a.Z=new ygp(l,a.api,a.K,a.J);var B=a.A(l);a.Y=await rgE(l,B,a.K,a.J,a.eF);await $Or(a)}else $W("PES is undefined")},$Or=async function(a){if(a.Z){a.Z.J||await yd(a.Z);
a.eF.W("woffle_enable_main_downloads_library")&&await a.cA();a.eF.W("html5_offline_playback_position_sync")&&(await a.RJ(),await a.bU(864E5));await a.refreshAllStaleEntities(43200,!0);await a.C();a.eF.W("html5_retry_downloads_for_expiration")&&await a.xV();a.Zh=g.tl(()=>{a.refreshAllStaleEntities(43200,!0);a.C()},9E5);
g.Jx(g.OE(),()=>a.Cz());
var l=await S8();await ghr(l);a8N(a.K)}else $W("transferManager is undefined")},qVr=async function(){const a=await S8();
if(!a)return[];const l=Date.now()/1E3,B=await E7(a,"offlineVideoPolicy");for(const u of B)u.expirationTimestamp&&Number(u.expirationTimestamp)<l&&(u.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE",u.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED",await zU(a,u,"offlineVideoPolicy"));return B.map(u=>u.key)},qU=async function(a,l,B,u,V){var b=await S8();
if(!b)return[];l=l.map(Q=>{var n=g.Om(Q,B);n={actionType:u,entityKey:n,actionMetadata:{...ng(),...V}};u!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(n.actionMetadata.priority=0);Q=new e1(B,Q,n);return Iv(Q)});
b=Ucv(b,l);Rde(a.K);return b},xOv=async function(a,l,B,u){const V=[];
for(const b of l)if(!b.upToDate&&(!B||b.shouldAutoSyncMetadata)&&b.playlistId){l={};switch(u){case "mainPlaylistEntity":l={mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:B}};break;case "musicPlaylist":l={musicPlaylistEntityActionMetadata:{autoSync:B}}}(l=await qU(a,[b.playlistId],u,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l))&&V.push(...l)}return V},Zqv=async function(a,l){if(l.length){const B=ng();
g.$F(B,Ti,{isEnqueuedForExpiredStreamUrlRefetch:!0});a.api.nV("qrd",{v:l.length});return qU(a,l,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B)}return[]},gUu=async function(a,l){const B=gd(l);
var u=g.iX(l.entityKey).entityId;let V=[];try{V=await dOn(a,u),a.eF.W("woffle_enable_main_downloads_library")&&V?.length&&await Lg(a.J,[l.entityKey])}catch(Q){return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.tx&&Q.type==="QUOTA_EXCEEDED"?(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):$W("Playlist add error"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
B,void 0,l,u)}const b=[];a.eF.W("html5_offline_prevent_redownload_downloaded_video")&&(V=await Qd(a.J,"mainVideoEntity",V));if(V?.length)for(const Q of V)a=Q.offlineVideoData,a?.videoId&&b.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"mainVideoEntity",Number(l.actionMetadata?.priority||0)+1,x_,Zm(l,a,u)));return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,b)},aKE=async function(a,l){const B=gd(l);
var u=l.entityKey,V=g.iX(u).entityId,b=[],Q=!1;V==="!*$_ALL_ENTITIES_!*$"?(Q=!0,b=await E7(a.J,"mainPlaylistEntity")):(u=await hs(a.J,u,"mainPlaylistEntity"))&&b.push(u);if(!b?.length)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);var n=g.S(l.actionMetadata,Ryv);u=n?.nextAutoRefreshIntervalSeconds;const e=n?.autoSync;let M=[],I=!0;n=!0;let F=!1;if(Q||e!==!1){try{M=await Tcv(0,!!e,!0,b)}catch(p){p instanceof Error&&p.message==="No data"?V==="!*$_ALL_ENTITIES_!*$"?await Kg(a.J,l,a.K,
"OFFLINE_DELETE_REASON_UNAVAILABLE"):await vU(V,a.J,l,a.K):p instanceof Error&&p.message==="Empty response body"&&$W(p.message)}if(!M.length||!Q&&M[0].playlistId!==V)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)}if(Q){l=[];for(var r of M)r.upToDate||e&&!r.shouldAutoSyncMetadata||!r.playlistId||l.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",r.playlistId,"mainPlaylistEntity",0,x_,{mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:r.checkInSeconds,autoSync:e}}));
return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,l)}M.length&&(r=M[0],F=!!r.upToDate,e&&(I=r.shouldAutoSyncMetadata??!0,n=r.shouldAutoSyncVideos??!0,r.checkInSeconds&&(u=r.checkInSeconds)));if(F||!I)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);r=[];b=b[0];Q=b.downloadState?await hs(a.J,b.downloadState,"mainPlaylistDownloadStateEntity"):void 0;Q=Q?.addedTimestampMillis?String(Q.addedTimestampMillis):void 0;try{r=await dOn(a,V,Q,u)}catch(p){if(p instanceof Error&&p.message===
"No data for playlist")await vU(V,a.J,l,a.K);else if(p instanceof Error&&p.message==="Empty response body for playlist")$W(p.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.tx&&p.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,l,V)}if(!n)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B);a=[];u=new Map;if(r?.length)for(var Y of r)n=Y.offlineVideoData,n?.videoId&&u.set(n.videoId,n);Y=new Map;n=[];if(b?.videos?.length)for(var N of b.videos)if(b=JSON.parse(g.iX(N).entityId).videoId)u.has(b)?(Y.set(b,u.get(b)),u.delete(b)):n.push(b);N=Number(l.actionMetadata?.priority||0)+1;for(const [p,J]of u.entries())a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"mainVideoEntity",N,x_,Zm(l,J,V)));for(const [p,J]of Y.entries())a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p,"mainVideoEntity",
N,x_,Zm(l,J,V)));for(const p of n)a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",p,"mainVideoEntity",0,x_,{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:{playlistId:V}}));return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,a)},lKu=async function(a,l){const B=gd(l);
try{const u=g.iX(l.entityKey).entityId;u==="!*$_ALL_ENTITIES_!*$"?await Kg(a.J,l,a.K,l.actionMetadata?.offlineLoggingData?.offlineDeleteReason):(await vU(u,a.J,l,a.K),a.eF.W("woffle_enable_main_downloads_library")&&await PU(a.J,l.entityKey))}catch(u){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B)},dOn=async function(a,l,B,u){l=await iC([l]);
const {mainPlaylistEntity:V,Tc:b}=await Bmn(a,l[0],B,u);a=FJp(V,b?.avatar);try{await rg(a)}catch(Q){Q instanceof Error&&Q.message==="Failed to fetch"&&$W(Q.message)}return l[0].videos},Zm=function(a,l,B){l={offlineVideoData:l,
playlistId:B};if(a=g.S(a.actionMetadata,Ryv))l.maximumDownloadQuality=a.maximumDownloadQuality;return{mainVideoEntityActionMetadata:l}},Bmn=async function(a,l,B,u){const V=Date.now().toString();
B||(B=V);var b=l.videos;const Q=l.playlistId,n=[],e=[];if(b)for(const r of b){b=r.offlineVideoData;if(!b||!b.videoId)throw $W("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");b=b.videoId;b={id:g.Om(JSON.stringify({videoId:b,playlistId:Q}),"mainPlaylistVideoEntity"),video:g.Om(b,"mainVideoEntity")};n.push(b);e.push(b.id)}let M;const I={key:g.Om(Q,"mainPlaylistDownloadStateEntity"),addedTimestampMillis:B,lastSyncedTimestampMillis:V},F={key:g.Om(Q,"mainPlaylistEntity"),
playlistId:Q,videos:e,title:l.title,thumbnailStyleData:u2r(l),visibility:VAv(l),downloadState:I.key};l.channel&&(B=l.channel.offlineChannelData,M=b_D(g.Om(Q,"ytMainChannelEntity"),B),F.channelOwner=M.id);F?.entityMetadata?(F.entityMetadata.offlineLastModifiedTimestampSeconds=l.lastModifiedTimestamp,u&&(F.entityMetadata.nextAutoRefreshIntervalSeconds=String(u))):F&&(F.entityMetadata={nextAutoRefreshIntervalSeconds:u?String(u):void 0,offlineLastModifiedTimestampSeconds:l.lastModifiedTimestamp});try{await H7(a.J,
{mode:"readwrite",uA:!0},r=>{var Y=Js(r,F,"mainPlaylistEntity");const N=Js(r,I,"mainPlaylistDownloadStateEntity");Y=[Y,N];for(const p of n)Y.push(Js(r,p,"mainPlaylistVideoEntity"));M&&Y.push(Js(r,M,"ytMainChannelEntity"));return g.CJ.all(Y)})}catch(r){throw $W("PES failure for playlist"),Error("PES failure for playlist");
}return{mainPlaylistEntity:F,Tc:M,HxP:n}},u2r=function(a){const l=[];
var B=a.videos;B&&B.length>0&&l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:B[0].offlineVideoData.thumbnail}}});if((a=a.additionalMetadadatas)&&a.length>0)for(const u of a)switch(a=u.offlineBundleItemPlaylistData,B={collageThumbnail:{coverThumbnail:a?.coverThumbnail}},a?.style){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),value:B});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),
value:B});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:B});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:B})}return l},VAv=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},b_D=function(a,l){return{id:a,
channelId:l.channelId,title:l.title,avatar:l.thumbnail}},nf_=async function(a,l){const B=gd(l);
var u=g.iX(l.entityKey).entityId;const V=g.S(l.actionMetadata,dg),b=!V?.playlistId;try{await Q7N(a,u,void 0,V?.offlineVideoData,b)}catch(Q){return u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.tx&&Q.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,u,l)}a=Number(l.actionMetadata?.priority||
0)+1;l=(l=g.S(l.actionMetadata,dg))?{playbackDataActionMetadata:{maximumDownloadQuality:l.maximumDownloadQuality}}:void 0;u=Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u,"playbackData",a,s7u,l);return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,[u])},ejp=async function(a,l){const B=gd(l),u=g.iX(l.entityKey).entityId;
var V=await hs(a.J,l.entityKey,"mainVideoEntity"),b=V?await hs(a.J,V.downloadState,"mainVideoDownloadStateEntity"):void 0;if(!V||!b)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);let Q;try{await Q7N(a,u,b.addedTimestampMillis,g.S(l.actionMetadata,dg)?.offlineVideoData),V=1,V=Number(l.actionMetadata?.priority||0)+1,Q=Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",u,"playbackData",V,s7u)}catch(n){if(n instanceof Error&&n.message==="No data"){V=await k_(a.J,u);if(b=g.S(l.actionMetadata,
dg)?.playlistId)V.playlistId=b;V.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";await Y_(u,a.J,l,a.K,V)}else if(n instanceof Error&&n.message==="Empty response body")$W(n.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.tx&&n.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
B,void 0,a,l)}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,Q?[Q]:void 0)},MAX=async function(a,l){const B=gd(l);
try{const u=g.iX(l.entityKey).entityId;if(u==="!*$_ALL_ENTITIES_!*$")await Kg(a.J,l,a.K,l.actionMetadata?.offlineLoggingData?.offlineDeleteReason);else{const V=await k_(a.J,u),b=g.S(l.actionMetadata,dg)?.playlistId;b&&(V.playlistId=b);V.offlineDeleteReason=l.actionMetadata?.offlineLoggingData?.offlineDeleteReason;await Y_(u,a.J,l,a.K,V);a.eF.W("woffle_enable_main_downloads_library")&&await PU(a.J,l.entityKey)}}catch(u){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},Q7N=async function(a,l,B,u,V){u||(u=(await iyo([l]))[0]);
const {mainVideoEntity:b,channelEntity:Q}=await IKN(a,u,B,V);try{const n=bC(b.thumbnail),e=bC(Q.avatar);await rg(n.concat(e))}catch(n){n instanceof Error&&n.message==="Failed to fetch"&&$W(n.message)}},IKN=async function(a,l,B,u){B||(B=Date.now().toString());
const V=l.channel?.offlineChannelData,b={id:g.Om(l.videoId,"ytMainChannelEntity"),channelId:V.channelId,title:V.title,avatar:V.thumbnail},Q={key:g.Om(l.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Om(l.videoId,"playbackData"),addedTimestampMillis:B,videoDownloadContextEntity:g.Om(l.videoId,"videoDownloadContextEntity")},n={key:g.Om(l.videoId,"videoPlaybackPositionEntity"),videoId:l.videoId,lastPlaybackPositionSeconds:"0"};let e;a.eF.W("html5_offline_playback_position_sync")&&(e={playbackPosition:n.key});
B=g.Om(l.videoId,"mainVideoEntity");const M={key:B,videoId:l.videoId,title:l.title,thumbnail:l.thumbnail,localizedStrings:{viewCount:l.shortViewCountText},userState:e,lengthSeconds:l.lengthSeconds?Number(l.lengthSeconds):void 0,publishedTimestampMillis:l.publishedTimestamp?(Number(l.publishedTimestamp)*1E3).toString():void 0,formattedDescription:l.description,owner:b.id,downloadState:Q.key};let I,F;a.eF.W("woffle_enable_main_downloads_library")&&u&&(u=await PUv(a.J,[B]))&&(I=u.mainDownloadsLibraryEntity,
F=u.mainDownloadsListEntity);let r;r={key:g.Om(l.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"};g.$F(Q,efv,r);await H7(a.J,{mode:"readwrite",uA:!0},Y=>{var N=Js(Y,b,"ytMainChannelEntity"),p=Js(Y,Q,"mainVideoDownloadStateEntity");const J=Js(Y,M,"mainVideoEntity");N=[N,p,J];a.eF.W("html5_offline_playback_position_sync")&&(p=Js(Y,n,"videoPlaybackPositionEntity"),N.push(p));I&&(p=Js(Y,I,"mainDownloadsLibraryEntity"),N.push(p));F&&(p=Js(Y,F,"mainDownloadsListEntity"),
N.push(p));r&&(Y=Js(Y,r,"downloadStatusEntity"),N.push(Y));return g.CJ.all(N)});
return{mainVideoEntity:M,channelEntity:b}},r_n=async function(a,l){const B=gd(l),u=[];
var V=await Dm.getInstance();let b,Q;V&&(b=await V.get("sdois"),Q=await V?.get("lmqf"));try{if(b===void 0)throw Error("prefStorage or opt-in state is undefined");V=[];b||(V=await LJX(a.J),V.reverse());if(V.length)for(const M of V){if(!M)continue;const I=g.iX(M).entityId,F=await k_(a.J,I);F.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE";await Y_(I,a.J,{entityKey:M,actionType:l.actionType},a.K,F)}const n=await zfv(b,Q??"SD");await vIe(n);const e=f8D(n);a.eF.W("woffle_enable_main_downloads_library")&&
(b||await PU(a.J,fg),await Lg(a.J,[fg]));if(e?.length)for(const M of e){const I=M.actionType,F=M.entityKey,r=M.actionMetadata;if(I&&F&&r&&!g.S(r,Fnr)){I==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(r.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});const Y=g.S(M.actionMetadata,dg);Y&&(Y.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",M.actionMetadata={...M.actionMetadata,mainVideoEntityActionMetadata:Y});u.push(M)}}}catch(n){return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.tx&&n.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,a,l)}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,u)},YuA=async function(a,l=43200,B=!0){if(!a.G.k8())return[];
let u=[];try{u=await Tcv(l,B,!1)}catch(V){V instanceof Error&&V.message==="No data"||V instanceof Error&&V.message==="Empty response body"&&$W(V.message)}return xOv(a,u,B,"mainPlaylistEntity")},vft=async function(a,l,B,u=!1){let V=[];
if(!await HyE()&&!u)return[];B=await D5E(l,B);if(!B?.length)return[];l={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};for(const Q of B){B=Q.actionType;var b=Q.entityKey;u=Q.actionMetadata;B&&b&&u&&!g.S(u,Fnr)&&(B==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(u.offlineLoggingData=l),{entityId:b}=g.iX(b),B=await qU(a,[b],"mainVideoEntity",B,u),V=V.concat(B))}return V},Nmt=async function(a,l){const B=gd(l);
var u=g.iX(l.entityKey).entityId;let V=[];try{V=await Knt(a,u),V?.length&&await Ug(a.J,l.entityKey)}catch(Q){return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.tx&&Q.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,l,u)}const b=[];V=await Qd(a.J,"musicTrack",V);if(V.length)for(const Q of V)a=
Q.offlineVideoData,a?.videoId&&b.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"musicTrack",Number(l.actionMetadata?.priority||0)+1,gg,JI(l,a,u)));return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,b)},fKo=async function(a,l){const B=gd(l);
var u=l.entityKey,V=g.iX(u).entityId,b=[],Q=!1;V==="!*$_ALL_ENTITIES_!*$"?(Q=!0,b=await E7(a.J,"musicAlbumRelease")):(u=await hs(a.J,u,"musicAlbumRelease"))&&b.push(u);if(!b?.length)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);if(Q){l=[];for(var n of b){var e=g.iX(n.id).entityId;l.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e,"musicAlbumRelease",0,gg))}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,l)}n=[];b=b[0];Q=void 0;b.downloadMetadata&&(Q=await hs(a.J,
b.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),Q=Number(Q?.addedTimestampMillis??"0")/1E3);try{n=await Knt(a,V,Q?.toString())}catch(F){if(F instanceof Error&&F.message==="No data")await pg(V,"musicAlbumRelease",a.J,l,a.K);else if(F instanceof Error&&F.message==="Empty response body")$W(F.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.tx&&F.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,l,e)}a=[];V=new Map;if(n?.length)for(var M of n)n=M.offlineVideoData,n?.videoId&&V.set(n.videoId,n);M=new Map;n=[];if(b?.tracks?.length)for(var I of b.tracks)if(b=g.iX(I).entityId)V.has(b)?(M.set(b,V.get(b)),V.delete(b)):n.push(b);I=Number(l.actionMetadata?.priority||0)+1;for(const [F,r]of V.entries())a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F,"musicTrack",I,gg,JI(l,r)));for(const [F,
r]of M.entries())a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",F,"musicTrack",I,gg,JI(l,r)));for(e of n)a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",e,"musicTrack",0,gg));return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,a)},Lno=async function(a,l){const B=gd(l);
try{const u=g.iX(l.entityKey).entityId;u==="!*$_ALL_ENTITIES_!*$"?await WU(a.J,l,a.K):(await pg(u,"musicAlbumRelease",a.J,l,a.K),await AI(a.J,l.entityKey))}catch(u){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},Knt=async function(a,l,B){l=await iC([l]);
a=await PDo(a,l[0],B);a=bC(a.thumbnailDetails);await rg(a);return l[0].videos},PDo=async function(a,l,B){var u=l.additionalMetadadatas;
let V=void 0;if(u&&u.length>0)for(var b of u)if(b.offlineMusicPlaylistData){V=b.offlineMusicPlaylistData;break}u=l.playlistId;const {lD:Q,HG:n}=U5r(l);B=B?(Number(B)*1E3).toString():Date.now().toString();b=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0";const e={id:g.Om(u,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:n,lastModifiedTimestampMillis:b,addedTimestampMillis:B,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},M={id:g.Om(u,"musicAlbumRelease"),
title:l.title,audioPlaylistId:u,trackCount:l.totalVideoCount,tracks:Q,downloadMetadata:e.id};V&&(M.thumbnailDetails=V.albumHqThumbnail??V.albumArtistThumbnail,M.artistDisplayName=V.albumArtistDisplayName,M.releaseDate=V.albumReleaseDate,M.contentRating={explicitType:V.albumReleaseExplicitType},M.releaseType=V.albumReleaseType);await H7(a.J,{mode:"readwrite",uA:!0},I=>{const F=Js(I,M,"musicAlbumRelease");I=Js(I,e,"musicAlbumReleaseDownloadMetadataEntity");return g.CJ.all([F,I])});
return M},c_r=async function(a,l){const B=gd(l);
var u=g.iX(l.entityKey).entityId;let V=[];try{V=await k6p(a,u),V?.length&&await Ug(a.J,l.entityKey)}catch(Q){return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.tx&&Q.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,l,u)}const b=[];V=await Qd(a.J,"musicTrack",V);if(V.length)for(const Q of V)a=
Q.offlineVideoData,a?.videoId&&b.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"musicTrack",Number(l.actionMetadata?.priority||0)+1,Rv,JI(l,a,u)));return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,b)},peE=async function(a,l){const B=gd(l);
var u=l.entityKey,V=g.iX(u).entityId,b=[],Q=!1;V==="!*$_ALL_ENTITIES_!*$"?(Q=!0,b=await E7(a.J,"musicPlaylist")):(u=await hs(a.J,u,"musicPlaylist"))&&b.push(u);if(!b?.length)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);const n=g.S(l.actionMetadata,AVe)?.autoSync;let e=[],M=!0;u=!0;let I=!1;var F=void 0;if(Q||n!==!1){try{e=await hfD(0,!!n,!0,b)}catch(J){J instanceof Error&&J.message==="No data"?V==="!*$_ALL_ENTITIES_!*$"?await WU(a.J,l,a.K):await pg(V,"musicPlaylist",a.J,l,a.K):J instanceof
Error&&J.message==="Empty response body"&&$W(J.message)}if(!e.length||!Q&&e[0].playlistId!==V)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)}if(Q){l=[];for(var r of e)r.upToDate||n&&!r.shouldAutoSyncMetadata||!r.playlistId||l.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",r.playlistId,"musicPlaylist",0,Rv,{musicPlaylistEntityActionMetadata:{autoSync:n}}));return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,l)}e.length&&(r=e[0],I=!!r.upToDate,n&&(M=r.shouldAutoSyncMetadata??
!0,u=r.shouldAutoSyncVideos??!0,r.checkInSeconds&&(F=r.checkInSeconds)));if(I||!M)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);r=[];b=b[0];Q=void 0;b.downloadMetadata&&(Q=await hs(a.J,b.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),Q=Number(Q?.addedTimestampMillis??"0")/1E3);try{r=await k6p(a,V,Q?.toString(),F)}catch(J){if(J instanceof Error&&J.message==="No data")await pg(V,"musicPlaylist",a.J,l,a.K);else if(J instanceof Error&&J.message==="Empty response body")$W(J.message);
else{l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";var Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED";J instanceof g.tx&&J.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE");return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,l,Y)}}if(!u)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);a=[];V=new Map;if(r?.length)for(var N of r)u=N.offlineVideoData,u?.videoId&&
V.set(u.videoId,u);N=new Map;u=[];if(b?.tracks?.length)for(var p of b.tracks)if(F=g.iX(p).entityId)V.has(F)?(N.set(F,V.get(F)),V.delete(F)):u.push(F);p=Number(l.actionMetadata?.priority||0)+1;for(const [J,z]of V.entries())a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"musicTrack",p,Rv,JI(l,z)));for(const [J,z]of N.entries())a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"musicTrack",p,Rv,JI(l,z)));for(Y of u)a.push(Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Y,"musicTrack",0,Rv));
return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,a)},Wnp=async function(a,l){const B=gd(l);
try{const u=g.iX(l.entityKey).entityId;u==="!*$_ALL_ENTITIES_!*$"?await WU(a.J,l,a.K):(await pg(u,"musicPlaylist",a.J,l,a.K),await AI(a.J,l.entityKey))}catch(u){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},k6p=async function(a,l,B,u){l=await iC([l]);
a=await UGD(a,l[0],B,u);a=bC(a.thumbnailDetails);await rg(a);return l[0].videos},UGD=async function(a,l,B,u){const V=l.playlistId,{lD:b,
HG:Q}=U5r(l);B=B?(Number(B)*1E3).toString():Date.now().toString();const n=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0",e={id:g.Om(V,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:Q,lastModifiedTimestampMillis:n,addedTimestampMillis:B,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},M={id:g.Om(V,"musicPlaylist"),title:l.title,playlistId:V,thumbnailDetails:l.thumbnail,visibility:A_u(l),trackCount:l.totalVideoCount,tracks:b,downloadMetadata:e.id};u&&(M?.entityMetadata?
M.entityMetadata.nextAutoRefreshIntervalSeconds=String(u):M&&(M.entityMetadata={nextAutoRefreshIntervalSeconds:String(u)}));await H7(a.J,{mode:"readwrite",uA:!0},I=>{const F=Js(I,M,"musicPlaylist");I=Js(I,e,"musicPlaylistDownloadMetadataEntity");return g.CJ.all([F,I])});
return M},A_u=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},O_u=async function(a,l){const B=gd(l);
var u=g.iX(l.entityKey).entityId;const V=g.S(l.actionMetadata,aO);try{await J_N(a,u,void 0,V?.track,V?.albumRelease),V?.playlistId||await Ug(a.J,l.entityKey)}catch(b){return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.tx&&b.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,
void 0,l,u)}a=(a=g.S(l.actionMetadata,aO))?{playbackDataActionMetadata:{maximumDownloadQuality:a.maximumDownloadQuality}}:void 0;l=Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u,"playbackData",Number(l.actionMetadata?.priority||0)+1,i_e,a);return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,[l])},Tmu=async function(a,l){const B=gd(l),u=g.iX(l.entityKey).entityId;
var V=await hs(a.J,l.entityKey,"musicTrack");const b=V?await hs(a.J,V.downloadMetadata,"musicTrackDownloadMetadataEntity"):void 0;if(!V||!b)return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B);let Q;V=g.S(l.actionMetadata,aO);try{await J_N(a,u,b.addedTimestampMillis,V?.track,V?.albumRelease),Q=Og("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",u,"playbackData",Number(l.actionMetadata?.priority||0)+1,i_e)}catch(n){if(n instanceof Error&&n.message==="No data")await cU(u,a.J,l,a.K);else if(n instanceof
Error&&n.message==="Empty response body")$W(n.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.tx&&n.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,a,l)}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,Q?[Q]:void 0)},H_E=async function(a,
l){const B=gd(l);
try{const u=g.iX(l.entityKey).entityId;u==="!*$_ALL_ENTITIES_!*$"?await WU(a.J,l,a.K):(await cU(u,a.J,l,a.K),await AI(a.J,l.entityKey))}catch(u){return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new zi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B)},J_N=async function(a,l,B,u,V){u||(u=(await iyo([l]))[0],u=WJv(u));
const {musicTrackEntity:b,NU:Q}=await zjo(a,u,l,V,B);a=bC(b.thumbnailDetails);l=[];Q&&(l=bC(Q.thumbnailDetails));await rg(a.concat(l))},zjo=async function(a,l,B,u,V){V||(V=Date.now().toString());
const b={id:g.Om(B,"musicTrackDownloadMetadataEntity"),playbackData:g.Om(B,"playbackData"),addedTimestampMillis:V,videoDownloadContextEntity:g.Om(B,"videoDownloadContextEntity")};u&&(l.albumRelease=u.id);await H7(a.J,{mode:"readwrite",uA:!0},Q=>{const n=[];var e=Js(Q,b,"musicTrackDownloadMetadataEntity");n.push(e);e=Js(Q,l,"musicTrack");n.push(e);u&&(Q=Js(Q,u,"musicAlbumRelease"),n.push(Q));return g.CJ.all(n)});
await BU(B,"musicTrackDownloadMetadataEntity",a.J,"DOWNLOAD_STATE_PENDING_DOWNLOAD");return{musicTrackEntity:l,NU:u}},DGv=async function(a,l=43200,B=!0){if(!a.G.k8())return[];
let u=[];try{u=await hfD(l,B,!1)}catch(V){}return xOv(a,u,B,"musicPlaylist")},hjt=function(a){let l;
a=g.S(a.getWatchNextResponse()?.currentVideoEndpoint,g.lg);a?.playlistId&&(l=a.playlistId);return l},Efp=async function(a,l){const B=l.clientPlaybackNonce,u={cpn:B,
offlineSourceVisualElement:g.WP(l.oJ||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};l.Z&&(u.videoFmt=Number(l.Z.itag));l.V&&(u.audioFmt=Number(l.V.itag));const V=hjt(l);var b;if(b=V&&l.videoId)l=l.videoId,b=await (V!=="PPSV"?Promise.resolve(!1):a.J.vA(l));b&&(u.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");a.Z=B;g.cP("offlinePlaybackStarted",u)};
g.qf.prototype.E4=g.BR(42,function(a){return this.app.E4(a)});
g.El.prototype.E4=g.BR(41,function(a){return g.DYD(this,9,a)});
var ls=class{constructor(a){this.J=a}},Bb=class extends ls{get entityMetadata(){return this.J.entityMetadata}set entityMetadata(a){this.J.entityMetadata=a}},ofv=class extends ls{Z(){const a=[];this.J.video&&a.push(this.J.video);return[...(new Set(a))]}},Su_=class extends ls{Z(){const a=[];this.J.video&&a.push(this.J.video);this.J.playlist&&a.push(this.J.playlist);this.J.videoItem&&a.push(this.J.videoItem);this.J.playlistItem&&a.push(this.J.playlistItem);return[...(new Set(a))]}},G6N=class extends ls{Z(){const a=
[];this.J.localImageEntities&&a.push(...this.J.localImageEntities);this.J.videoDownloadContextEntity&&a.push(this.J.videoDownloadContextEntity);return[...(new Set(a))]}},Xen=class extends ls{Z(){const a=[];this.J.recommendedVideoMetadata&&a.push(...(new G6N(this.J.recommendedVideoMetadata)).Z());return[...(new Set(a))]}},j7n=class extends ls{Z(){const a=[];this.J.playbackPosition&&a.push(this.J.playbackPosition);return[...(new Set(a))]}},tAD=class extends ls{Z(){const a=[];this.J.creatorEntity&&a.push(this.J.creatorEntity);
return[...(new Set(a))]}},EIp=["browse","music/browse","streaming_browse","unplugged/browse"],Gto=["offline/playlist_sync_check"],JVp=["offline"],oI_=["offline/offline_video_playback_position_sync"],Bco=["offline/get_playback_data_entity"],Dm=class{constructor(a){this.token=a}static async getInstance(){return new Promise(a=>{g.KM().then(l=>{l?(Dm.instance||(Dm.instance=new Dm(l)),a(Dm.instance)):a(void 0)})})}async get(a){if(a=await (await KF(this.token)).get("prefs",a)){var l=(0,g.X)();
return a.expirationTimestampMs<=l?void 0:a.value}}async set(a,l,B=31536E3){const u=(0,g.X)();a={key:a,value:l,expirationTimestampMs:u+B*1E3};await (await KF(this.token)).put("prefs",a)}async remove(a){await (await KF(this.token)).delete("prefs",a)}},fF,weE={INVALID_ENCODER_VERSION:"Invalid encoder version",KEY_CREATION_FAILED:"Failed to create encoder key",UNKNOWN_DECODE_ERROR:"Failed to decode PES data",UNKNOWN_ENCODE_ERROR:"Failed to encode PES data",WRONG_DATA_TYPE:"Encoder cannot process the data type"},
LF=class extends g.UE{constructor(a,l={}){super(weE[a],{name:"PESEncoderError",type:a,...l});this.type=a;this.level="WARNING";Object.setPrototypeOf(this,LF.prototype)}},mGr=class{},y_u=class extends mGr{constructor(a){super();this.J=a}K(a,l){l=P7(l);a=(new TextEncoder).encode(JSON.stringify(a));return this.J.encrypt(a,l)}Z(a,l){if(!(a instanceof Uint8Array))throw new LF("WRONG_DATA_TYPE",{vW:1});const B=new TextDecoder;l=P7(l);a=this.J.decrypt(a,l);return JSON.parse(B.decode(a))}},KDo={accountLinkStatusEntity:class extends Bb{Z(){return[]}},
booleanEntity:class extends Bb{Z(){return[]}},buttonEntity:class extends Bb{Z(){return[]}},captionTrack:class extends Bb{Z(){return[]}},channelHandle:class extends Bb{Z(){return[]}},chatLoadingStateEntity:class extends Bb{Z(){return[]}},chipEntity:class extends Bb{Z(){return[]}},commerceAcquisitionClientPayloadEntity:class extends Bb{Z(){return[]}},commerceCartListEntity:class extends Bb{Z(){return[]}},compositeSourceEntity:class extends Bb{Z(){return[]}},multiviewStagingEntity:class extends Bb{Z(){const a=
[];this.J.compositeSourceKeys&&a.push(...this.J.compositeSourceKeys);return[...(new Set(a))]}},contextNoteFeedEntityPayload:class extends Bb{Z(){return[]}},contextNoteUserRatingEntityPayload:class extends Bb{Z(){return[]}},continuationTokenEntity:class extends Bb{Z(){return[]}},downloadQualityPickerEntity:class extends Bb{Z(){return[]}},downloadsPageRefreshTokenEntity:class extends Bb{Z(){return[]}},downloadsPageViewConfigurationEntity:class extends Bb{Z(){return[]}},downloadStatusEntity:class extends Bb{Z(){return[]}},
dismissState:class extends Bb{Z(){return[]}},sfvAudioItemCurrentlyPlayingEntity:class extends Bb{Z(){return[]}},emojiFountainDataEntity:class extends Bb{Z(){return[]}},emojiCustomizationSetEntity:class extends Bb{Z(){return[]}},fakeChannel:class extends Bb{Z(){const a=[];this.J.alternateChannel&&a.push(this.J.alternateChannel);this.J.alternateChannelList&&a.push(...this.J.alternateChannelList);this.J.oneofChannelEntity&&a.push(this.J.oneofChannelEntity);return[...(new Set(a))]}},fakePlaylist:class extends Bb{Z(){const a=
[];this.J.entryCollection&&a.push(this.J.entryCollection);return[...(new Set(a))]}},fakePlaylistEntryCollection:class extends Bb{Z(){const a=[];this.J.parentPlaylist&&a.push(this.J.parentPlaylist);if(this.J.entries)for(const l of this.J.entries)a.push(...(new ofv(l)).Z());return[...(new Set(a))]}},fakeVideo:class extends Bb{Z(){const a=[];this.J.descriptionEntity&&a.push(this.J.descriptionEntity);this.J.creators&&a.push(...this.J.creators);this.J.theBiggestFan&&a.push(this.J.theBiggestFan);return[...(new Set(a))]}},
fakeVideoDescription:class extends Bb{Z(){return[]}},featuredProductsEntity:class extends Bb{Z(){return[]}},flowStateEntity:class extends Bb{Z(){return[]}},iconBadgeEntity:class extends Bb{Z(){return[]}},interstitialInteractionStateEntity:class extends Bb{Z(){return[]}},likeButtonAnimationEntity:class extends Bb{Z(){return[]}},liveChatPollStateEntity:class extends Bb{Z(){return[]}},dataFreshnessEntity:class extends Bb{Z(){return[]}},liveViewerLeaderboardChatEntryPointStateEntity:class extends Bb{Z(){return[]}},
liveViewerLeaderboardPointsEntity:class extends Bb{Z(){return[]}},liveReactionsDataEntity:class extends Bb{Z(){return[]}},logoEntity:class extends Bb{Z(){return[]}},macroMarkerEntity:class extends Bb{Z(){return[]}},mainDownloadsLibraryEntity:class extends Bb{Z(){const a=[];this.J.downloadsList&&a.push(this.J.downloadsList);this.J.smartDownloadsList&&a.push(this.J.smartDownloadsList);this.J.recommendedDownloadsList&&a.push(this.J.recommendedDownloadsList);this.J.refresh&&a.push(this.J.refresh);return[...(new Set(a))]}},
mainDownloadsListEntity:class extends Bb{Z(){const a=[];this.J.refresh&&a.push(this.J.refresh);if(this.J.downloads)for(const l of this.J.downloads)a.push(...(new Su_(l)).Z());return[...(new Set(a))]}},mainPlaylistDownloadStateEntity:class extends Bb{Z(){const a=[];this.J.localImageEntities&&a.push(...this.J.localImageEntities);return[...(new Set(a))]}},mainPlaylistEntity:class extends Bb{Z(){const a=[];this.J.channelOwner&&a.push(this.J.channelOwner);this.J.videos&&a.push(...this.J.videos);this.J.collaboratorChannels&&
a.push(...this.J.collaboratorChannels);this.J.downloadState&&a.push(this.J.downloadState);this.J.refresh&&a.push(this.J.refresh);return[...(new Set(a))]}},mainPlaylistVideoEntity:class extends Bb{Z(){const a=[];this.J.video&&a.push(this.J.video);this.J.channelContributor&&a.push(this.J.channelContributor);return[...(new Set(a))]}},mainVideoDownloadStateEntity:class extends Bb{Z(){const a=[];this.J.playbackData&&a.push(this.J.playbackData);this.J.localImageEntities&&a.push(...this.J.localImageEntities);
this.J.videoDownloadContextEntity&&a.push(this.J.videoDownloadContextEntity);return[...(new Set(a))]}},mainVideoEntity:class extends Bb{Z(){const a=[];this.J.owner&&a.push(this.J.owner);this.J.downloadState&&a.push(this.J.downloadState);this.J.userState&&a.push(...(new j7n(this.J.userState)).Z());this.J.additionalMetadata&&a.push(...(new Xen(this.J.additionalMetadata)).Z());return[...(new Set(a))]}},markersEngagementPanelSyncEntity:class extends Bb{Z(){return[]}},markersVisibilityOverrideEntity:class extends Bb{Z(){return[]}},
musicAlbumReleaseDetail:class extends Bb{Z(){const a=[];this.J.albumRelease&&a.push(this.J.albumRelease);this.J.tracks&&a.push(...this.J.tracks);return[...(new Set(a))]}},musicAlbumReleaseDownloadMetadataEntity:class extends Bb{Z(){const a=[];this.J.trackDownloadMetadatas&&a.push(...this.J.trackDownloadMetadatas);return[...(new Set(a))]}},musicAlbumRelease:class extends Bb{Z(){const a=[];this.J.musicLibraryStatusEntity&&a.push(this.J.musicLibraryStatusEntity);this.J.primaryArtists&&a.push(...this.J.primaryArtists);
this.J.details&&a.push(this.J.details);this.J.userDetails&&a.push(this.J.userDetails);this.J.tracks&&a.push(...this.J.tracks);this.J.share&&a.push(this.J.share);this.J.downloadMetadata&&a.push(this.J.downloadMetadata);this.J.refresh&&a.push(this.J.refresh);return[...(new Set(a))]}},musicAlbumReleaseUserDetail:class extends Bb{Z(){const a=[];this.J.albumRelease&&a.push(this.J.albumRelease);return[...(new Set(a))]}},musicArtistDetail:class extends Bb{Z(){const a=[];this.J.parentArtist&&a.push(this.J.parentArtist);
return[...(new Set(a))]}},musicArtist:class extends Bb{Z(){const a=[];this.J.details&&a.push(this.J.details);this.J.userDetails&&a.push(this.J.userDetails);return[...(new Set(a))]}},musicArtistUserDetail:class extends Bb{Z(){const a=[];this.J.parentArtist&&a.push(this.J.parentArtist);return[...(new Set(a))]}},musicDownloadsLibraryEntity:class extends Bb{Z(){const a=[];this.J.downloadedTracks&&a.push(...this.J.downloadedTracks);this.J.smartDownloadedTracks&&a.push(...this.J.smartDownloadedTracks);
this.J.downloadedEpisodes&&a.push(...this.J.downloadedEpisodes);this.J.downloadedAlbumReleases&&a.push(...this.J.downloadedAlbumReleases);this.J.smartDownloadedAlbumReleases&&a.push(...this.J.smartDownloadedAlbumReleases);this.J.downloadedPlaylists&&a.push(...this.J.downloadedPlaylists);this.J.smartDownloadedPlaylists&&a.push(...this.J.smartDownloadedPlaylists);this.J.metadataOnlyTracks&&a.push(...this.J.metadataOnlyTracks);return[...(new Set(a))]}},musicLibraryEdit:class extends Bb{Z(){return[]}},
musicLibraryStatusEntity:class extends Bb{Z(){return[]}},musicPlaylist:class extends Bb{Z(){const a=[];this.J.tracks&&a.push(...this.J.tracks);this.J.refresh&&a.push(this.J.refresh);this.J.musicLibraryStatusEntity&&a.push(this.J.musicLibraryStatusEntity);this.J.details&&a.push(this.J.details);this.J.downloadMetadata&&a.push(this.J.downloadMetadata);this.J.sideloadMetadata&&a.push(this.J.sideloadMetadata);this.J.userDetails&&a.push(this.J.userDetails);this.J.entryCollection&&a.push(this.J.entryCollection);
this.J.share&&a.push(this.J.share);this.J.podcastShowAdditionalMetadata&&a.push(...(new tAD(this.J.podcastShowAdditionalMetadata)).Z());return[...(new Set(a))]}},musicPlaylistDownloadMetadataEntity:class extends Bb{Z(){const a=[];this.J.trackDownloadMetadatas&&a.push(...this.J.trackDownloadMetadatas);return[...(new Set(a))]}},musicShare:class extends Bb{Z(){return[]}},musicTrackDetail:class extends Bb{Z(){const a=[];this.J.parentTrack&&a.push(this.J.parentTrack);return[...(new Set(a))]}},musicTrackDownloadMetadataEntity:class extends Bb{Z(){const a=
[];this.J.playbackData&&a.push(this.J.playbackData);this.J.localImageEntities&&a.push(...this.J.localImageEntities);this.J.videoDownloadContextEntity&&a.push(this.J.videoDownloadContextEntity);return[...(new Set(a))]}},musicTrack:class extends Bb{Z(){const a=[];this.J.musicLibraryStatusEntity&&a.push(this.J.musicLibraryStatusEntity);this.J.artists&&a.push(...this.J.artists);this.J.audioModeVersion&&a.push(this.J.audioModeVersion);this.J.videoModeVersion&&a.push(this.J.videoModeVersion);this.J.userDetails&&
a.push(this.J.userDetails);this.J.details&&a.push(this.J.details);this.J.albumRelease&&a.push(this.J.albumRelease);this.J.share&&a.push(this.J.share);this.J.libraryEdit&&a.push(this.J.libraryEdit);this.J.downloadMetadata&&a.push(this.J.downloadMetadata);this.J.playbackPosition&&a.push(this.J.playbackPosition);this.J.lyrics&&a.push(this.J.lyrics);return[...(new Set(a))]}},musicTrackUserDetail:class extends Bb{Z(){const a=[];this.J.parentTrack&&a.push(this.J.parentTrack);return[...(new Set(a))]}},offlineOrchestrationActionWrapperEntity:class extends Bb{Z(){return[]}},
offlineVideoPolicy:class extends Bb{Z(){return[]}},offlineVideoStreams:class extends Bb{Z(){return[]}},offlineabilityEntity:class extends Bb{Z(){return[]}},orchestrationWebSamplingEntity:class extends Bb{Z(){const a=[];this.J.fakeChildren&&a.push(...this.J.fakeChildren);return[...(new Set(a))]}},pageHeaderEntity:class extends Bb{Z(){return[]}},pdpStateEntity:class extends Bb{Z(){return[]}},pinnedProductEntity:class extends Bb{Z(){return[]}},playbackData:class extends Bb{Z(){const a=[];this.J.transfer&&
a.push(this.J.transfer);this.J.adsPlaybackData&&a.push(...this.J.adsPlaybackData);this.J.drmLicense&&a.push(this.J.drmLicense);this.J.offlineVideoPolicy&&a.push(this.J.offlineVideoPolicy);this.J.videoDownloadContextEntity&&a.push(this.J.videoDownloadContextEntity);return[...(new Set(a))]}},playerStateEntity:class extends Bb{Z(){return[]}},quantityIncrementerEntity:class extends Bb{Z(){return[]}},refresh:class extends Bb{Z(){return[]}},saveToPlaylistListEntity:class extends Bb{Z(){return[]}},selectedChipIndexEntityPayload:class extends Bb{Z(){return[]}},
settingEntity:class extends Bb{Z(){return[]}},stringEntity:class extends Bb{Z(){return[]}},suggestedFeedbackChipStateEntity:class extends Bb{Z(){return[]}},transfer:class extends Bb{Z(){const a=[];this.J.offlineVideoStreams&&a.push(...this.J.offlineVideoStreams);this.J.captionTrack&&a.push(...this.J.captionTrack);return[...(new Set(a))]}},trendingOfferEntity:class extends Bb{Z(){return[]}},videoDownloadContextEntity:class extends Bb{Z(){return[]}},videoOverviewAsyncDataEntity:class extends Bb{Z(){return[]}},
videoPlaybackPositionEntity:class extends Bb{Z(){return[]}},votingEntity:class extends Bb{Z(){return[]}},ytMainChannelEntity:class extends Bb{Z(){const a=[];this.J.userChannelDetails&&a.push(this.J.userChannelDetails);return[...(new Set(a))]}},youchatPendingResponseEntity:class extends Bb{Z(){return[]}},ytMainDownloadedVideoEntity:class extends Bb{Z(){const a=[];this.J.video&&a.push(this.J.video);this.J.playbackData&&a.push(this.J.playbackData);this.J.offlineVideoPolicy&&a.push(this.J.offlineVideoPolicy);
return[...(new Set(a))]}},ytMainVideoEntity:class extends Bb{Z(){const a=[];this.J.channelOwner&&a.push(this.J.channelOwner);this.J.playbackPosition&&a.push(this.J.playbackPosition);this.J.localImageEntities&&a.push(...this.J.localImageEntities);this.J.downloadStatus&&a.push(this.J.downloadStatus);return[...(new Set(a))]}}},WDD=class{constructor(a,l){this.J=a;this.Z=l;this.K={}}},$Go=class extends mGr{K(a){return a}Z(a){if(a instanceof Uint8Array)throw new LF("WRONG_DATA_TYPE",{vW:0});return a}},
JQo=class{constructor(){this.J={};this.J[0]=new $Go;if(!g.$M("aes_pes_encoder_killswitch")){var a=this.J;try{const u=g.pJ();var l=P7(u);var B=new y_u(new g.Go(l),new g.$x(l))}catch(u){throw a=u instanceof Error?new LF("KEY_CREATION_FAILED",{originalMessage:u.message}):new LF("KEY_CREATION_FAILED"),g.w(a),a;}a[1]=B}}},iRr=class extends g.e${constructor(a,l){super();this.token=a;this.J=l;this.observers=[];a=new g.Kx.BroadcastChannel(`${"PERSISTENT_ENTITY_STORE_SYNC"}:${g.pJ()}`);a.onmessage=this.Z.bind(this);
this.channel=a}observe(a){this.observers.push(a);return()=>{const l=this.observers.indexOf(a);l>=0&&this.observers.splice(l,1)}}Z(a){pdp(this,a.data)}VI(){this.channel.close()}},oB;var KJ_=new g.R("elementsCommand");var NU=new g.R("entityBatchUpdate");var efv=new g.R("downloadStatusEntity");var Ryv=new g.R("mainPlaylistEntityActionMetadata");var dg=new g.R("mainVideoEntityActionMetadata");var AVe=new g.R("musicPlaylistEntityActionMetadata");var aO=new g.R("musicTrackEntityActionMetadata");var NcX=new g.R("offlineOrchestrationActionCommand");var Fnr=new g.R("localImageEntityActionMetadata");var Ti=new g.R("playbackDataActionMetadata");var VGA=new g.R("transferEntityActionMetadata");var qAt=new g.R("videoPlaybackPositionEntityActionMetadata");var wdo=class{constructor(){this.J=new Map}},Xq;g.Om("","downloadsPageViewConfigurationEntity");g.Om("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");var fg=g.Om("DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS","mainDownloadsListEntity");g.Om("DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS","refresh");g.Om("SMART_DOWNLOADS_ENABLED","settingEntity");new g.KK;new g.KK;var qyn=class{constructor(){this.locks=navigator.locks}request(a,l={},B){return this.locks.request(a,l,u=>B(u))}};var wd=g.Kx.caches,ts,m9,CDu=class{open(a){return wd.open(j8(a))}has(a){return wd.has(j8(a))}delete(a){return wd.delete(j8(a))}async match(a,l){var B=await this.keys();for(const u of B)if(B=await (await this.open(u)).match(a,l))return B}},dct=class extends CDu{async keys(){const a=[],l=g.pJ("CacheStorage keys");var B=await wd.keys();for(const u of B){B=u.indexOf(":");const {eL:V,datasyncId:b}=B===-1?{eL:u}:{eL:u.substring(0,B),datasyncId:u.substring(B+1)};b===l&&a.push(V)}return a}};var qun=class extends g.e${constructor(a){super();this.api=a;this.Dv={hBk:()=>this.J,
yKJ:()=>this.Z};
typeof g.Kx.BroadcastChannel!=="undefined"&&(this.J=new g.Kx.BroadcastChannel(`${"PLAYER_OFFLINE_ERROR_SYNC"}:${g.pJ()}`),this.J.onmessage=this.K.bind(this),this.Z=new g.Kx.BroadcastChannel(`${"PLAYER_OFFLINE_PAUSE_SYNC"}:${g.pJ()}`),this.Z.onmessage=this.V.bind(this))}K(a){g.$8(this.api,"onOfflineOperationFailure",a.data)}V(a){this.api.publish("offlinetransferpause",a.data)}VI(){this.J?.close();this.Z?.close()}};var xGn=class{constructor(a,l,B){this.Y=a;this.C=l;this.visibility=B;this.B=this.G=this.A=this.K=this.J=!1;this.V=new g.ar(()=>{this.Oh()});
this.Dv={t5:()=>this.Z,
Oh:()=>{this.Oh()},
kQk:()=>this.V};
this.visibility.subscribe("visibilitystatechange",()=>{this.AK()})}AK(){this.J&&qw(this)}Oh(){this.Z&&this.Z.resolve();
this.K=this.J=!1;this.C()}};var Ple=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var e1=class{constructor(a,l,B,u,V=l,b,Q,n,e,M,I){this.entityType=a;this.actionId=l;this.action=B;this.parentActionId=u;this.rootActionId=V;this.childActionIds=b;this.prereqActionId=Q;this.postreqActionIds=n;this.hasChildActionFailed=M;this.retryScheduleIndex=0;this.J=I||Date.now();this.retryScheduleIndex=e||0}};var YAo="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var pHu="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");var us=class{constructor(a){this.J=a}},zi=class{constructor(a,l,B,u,V,b){this.status=a;this.J=l;this.V=B;this.Z=u;this.K=V;this.downloadState=b}};var Z_D=class extends us{constructor(a,l,B){super(a);this.J=a;this.eF=l;this.K=B}Z(a){return RB(a)?wHD(this,a):av(a)?$5u(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}};var dGt=class extends us{constructor(a,l){super(a);this.J=a;this.eF=l}Z(a){return av(a)?CUN(this,a):nIE(a)?x5u(this,a):lC(a)?Zyv(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}};var gfr=class{constructor(a,l){this.api=a;this.J=l;this.logger=new g.DH("woffle");this.Z=!1;this.Dv={dw:this.dw}}async V(a){if(a.state.J(128)){const l=a.state.Pe;a=l?.errorCode;a=a==="net.connect"&&l?.NG===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":a?.startsWith("net.")?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";await this.EK(this.player.getVideoData().videoId,a)}}async EK(a,l){this.Z||(this.Z=!0,l==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?ov(this,a,!1,!0):(await Eg(this,a),
g.jK(a,4),await this.J.EK(l)))}sK(a){a.status===2?(a.status!==this.K&&($_(this.J),g.jK(a.videoId,2)),a.Au&&TUE(this.J,a.videoId,a.Au)):a.status===4?(Eg(this,a.videoId),this.EK(a.videoId,a.Bm?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):a.status===1&&zyo(this.J);this.K=a.status;g.$8(this.api,"localmediachange",{videoId:a.videoId,status:a.status})}async Lp(){if(!this.Z){this.Z=!0;var a=this.player.getVideoData().videoId;await Eg(this,a);await this.J.Lp()}}dw(a){switch(a){case "HD_1080":return"hd1080";
case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}}W(a){return this.api.U().W(a)}};var RjE=class extends us{constructor(a,l){super(a);this.J=a;this.eF=l}Z(a){return RB(a)?lev(this,a):av(a)?BUu(this,a):nIE(a)?uEp(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}};var a7t=class{constructor(){this.actions=[]}J(a,l){let B=a.action.actionMetadata.priority-l.action.actionMetadata.priority;B===0&&(a.J<l.J?B=-1:a.J>l.J&&(B=1));return B}};var MGv=class extends g.e${constructor(a,l,B,u,V){super();this.Z=a;this.oJ=l;this.Zh=B;this.G=u;this.eF=V;this.J=new a7t;this.A=new g.rS;this.K=new g.ar(()=>{this.retry()});
this.Y=NaN;this.B=!1;this.Dv={FEA:()=>this.J,
YY:()=>this.A,
dkV:()=>this.K,
retry:()=>this.retry()};
g.W(this,this.K);this.C=this.Z.observe(this.D.bind(this))}VI(){this.C&&this.C();super.VI()}createAction(a,l){const B=g.iX(a.entityKey).entityType,u=g.pG(16);return new e1(B,u,a,l.actionId,l.rootActionId)}async D(a){if(!this.HA()){var l=a.offlineOrchestrationActionWrapperEntity??new Set;a=[];for(var B of l)({entityId:l}=g.iX(B)),eyn(this.J,l)||a.push(B);B=await fee(this,a);await Xx(this,B)}}async retry(){await cgA(this)}};var l7u=class{constructor(a){this.gP=a;this.J=void 0}async pj(a,l=!0){if(this.J){var B=[],u=g.lq(this.J.J,l),V=[];for(let b=0;b<u.length;b++)l=this.J.A(u[b],"json3"),l=g.QS(l,{withCredentials:!0,format:"RAW"},3,500).then(Q=>{Q={metadata:g.pr(u[b]),trackData:Q.xhr.responseText};V.push(Q)}).Je(Q=>{$W("Caption fetch error",Q)}),B.push(l);
await nhE(B);try{await ohe(a,V)}catch(b){$W("Caption DB transaction error",b)}}}};var BVE=class extends g.e${constructor(a){super();this.J=a;this.Z=this.J.observe(this.K.bind(this))}VI(){this.Z&&this.Z();super.VI()}async K(a){var l=a.transfer??new Set;a=[];for(const B of l)({entityId:l}=g.iX(B)),a.push(l);a.length!==0&&await UOv(this,a)}};var ygp=class extends g.e${constructor(a,l,B,u){super();this.Z=a;this.api=l;this.bd=B;this.D=u;this.A=new g.rS;this.V=new g.ar(()=>{this.J&&this.J.transferState==="TRANSFER_STATE_TRANSFERRING"&&this.A.k8()&&((this.J.transferRetryCount||0)<3?ov(this.G,this.B,!1,!1):Eg(this.G,this.B.videoDetails.videoId),this.EK("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Zh=this.RJ=0;this.C=this.Y=!1;this.PA=g.fm(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.aJ=new g.B1(this);this.Dv={gsk:()=>this.V,
vsI:()=>this.D,
YY:()=>this.A};
this.oJ=this.Z.observe(this.z8.bind(this));this.G=new gfr(l,this);this.ud=new l7u(l);this.vA=new BVE(this.Z);this.SF=this.A.listen("publicytnetworkstatus-online",this.UG.bind(this));this.cA=this.A.listen("publicytnetworkstatus-offline",this.G8.bind(this));this.C=this.api.U().W("html5_less_transfer_processing_logs");g.W(this,this.aJ);this.aJ.O(l,"offlinetransferpause",this.Ok);if(g.AT(this.api.U()))this.K="mainVideoDownloadStateEntity";else if(g.a5(this.api.U())||g.eK(this.api.U()))this.K="musicTrackDownloadMetadataEntity"}VI(){this.oJ&&
this.oJ();this.vA.dispose();this.V.dispose();this.SF&&g.fV(this.A.Ru,this.SF);this.cA&&g.fV(this.A.Ru,this.cA);super.VI()}async Ok(a){const l=g.Om(a,"transfer");if(this.J&&l===this.J.key)ov(this.G,this.B,!0),this.V.stop();else{const B=await H7(this.Z,{mode:"readwrite",uA:!0},u=>pF(u,l,"transfer").then(V=>{if(V&&V.transferState!=="TRANSFER_STATE_COMPLETE"&&V.transferState!=="TRANSFER_STATE_FAILED")return V.transferState="TRANSFER_STATE_PAUSED_BY_USER",Js(u,V,"transfer").then(()=>V)}));
if(B){a&&this.K&&await BU(a,this.K,this.Z,"DOWNLOAD_STATE_PAUSED");const u=await tI(this,a);Qke({videoId:a,C_:B,offlineModeType:u})}}}G8(){if(this.J&&this.B){ov(this.G,this.B,!1);const a=this.J,l=a?.key?g.iX(a.key).entityId:"";l&&this.K&&(new Promise((B,u)=>{BU(l,this.K,this.Z,"DOWNLOAD_STATE_PAUSED").catch(V=>{u(V)})})).catch(B=>{$W("Download state setting error",B)})}this.V.stop()}UG(){this.J?Xun(this,this.J):yd(this)}async z8(a){if(this.J&&(this.J.transferState!=="TRANSFER_STATE_COMPLETE"&&this.J.transferState!==
"TRANSFER_STATE_FAILED"&&a.transfer&&a.transfer.has(this.J.key)&&((this.J=await hs(this.Z,this.J.key,"transfer"))||await jKo(this)),this.J))return;
await yd(this)}async EK(a,l){if(this.J){var B=this.J;const V=B?.key?g.iX(B.key).entityId:"";a:switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var u=!1;break a;default:u=!0}u&&tGt(this)?(await j1(this,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),a=await tI(this,V),dd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:V,C_:B,offlineModeType:a}),
V&&this.K&&await BU(V,this.K,this.Z,"DOWNLOAD_STATE_RETRYABLE_FAILURE")):(await wu_(this,a),V&&this.K&&await BU(V,this.K,this.Z,"DOWNLOAD_STATE_FAILED"))}else wg(this,`onTransferFailure: ${a}`);m2(this);B=yd(this,!0);l&&l(B)}async Lp(a){if(this.J)if(tGt(this)){await j1(this,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH");this.J||wg(this,"onMaybeTransferStreamsExpiredRetryAttempting");var l=this.J,B=l?.key?g.iX(l.key).entityId:"",u=await tI(this,B);dd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},
{videoId:B,C_:l,offlineModeType:u});l=ng();g.$F(l,Ti,{isEnqueuedForExpiredStreamUrlRefetch:!0});u=g.Om(B,"playbackData");B=Iv(new e1("playbackData",B,{actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:u,actionMetadata:l}));await zU(this.Z,B,"offlineOrchestrationActionWrapperEntity")}else await wu_(this,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),this.K&&(B=this.J,(B=B?.key?g.iX(B.key).entityId:"")&&await BU(B,this.K,this.Z,"DOWNLOAD_STATE_FAILED"));else wg(this,"onMaybeTransferStreamsExpired");
m2(this);B=yd(this,!0);a&&a(B)}},Cg={TRANSFER_STATE_TRANSFERRING:1,TRANSFER_STATE_TRANSFER_IN_QUEUE:2};var uJu=class{constructor(a,l){this.eF=a;this.api=l;this.G=new g.rS;this.B=new g.KK;this.Dv={t5:()=>this.K.Dv.t5(),
YY:()=>this.G,
KE5:()=>this.K,
Ah:()=>this.Ah(),
HN:()=>this.HN(),
qC:()=>this.qC(),
Cz:()=>this.Cz(),
xV:()=>this.xV(),
bU:B=>this.bU(B)};
this.K=new xGn(()=>mOt(this),()=>{this.qC()},this.api.nj(),this.api.W.bind(this.api));
this.J=new qun(this.api);Rde(this.K)}Ah(){return this.B.promise}HN(){if(this.Z&&this.Y)return this.B.promise;Clo(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise}A(a){return{playbackData:new Z_D(a,this.eF,this.J),transfer:new RjE(a,this.eF),videoPlaybackPositionEntity:new dGt(a,this.eF)}}async Cz(){this.Z&&await DOo(this.Z)}async qC(){if(this.Z||this.Y)await this.Ah(),this.Zh!==void 0&&(g.mW(this.Zh),this.Zh=void 0),this.V!==void 0&&(g.mW(this.V),this.V=void 0),this.Z?.dispose(),
this.Z=void 0,this.Y?.dispose(),this.Y=void 0,g.$8(this.api,"onOrchestrationLostLeader"),this.B=new g.KK}isOrchestrationLeader(){return this.K.J}async vA(){return!1}BZ(a){var l=this.J;l.api.publish("offlinetransferpause",a);l.Z?.postMessage(a)}async UG(a){const l=await S8();if(l){var B=g.Om(a,"transfer");await H7(l,{mode:"readwrite",uA:!0},u=>{const V=pF(u,B,"transfer"),b=pF(u,g.Om(a,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.CJ.all([V,b]).then(([Q,n])=>Q&&Q.transferState===
"TRANSFER_STATE_PAUSED_BY_USER"?(Q.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Js(u,Q,"transfer").then(()=>{dd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",statusType:"USER_RESUMED"},{videoId:a,C_:Q,offlineModeType:n?.offlineModeType});return g.CJ.resolve(null)})):g.CJ.resolve(null))})}}async oJ(a=43200){if(!this.G.k8())return qVr();
var l=await S8();if(!l)return[];const B=Date.now()/1E3;var u=await E7(l,"offlineVideoPolicy");l=[];for(const V of u)Number(V.lastUpdatedTimestampSeconds)+a<=B&&(u=g.iX(V.key).entityId,l.push(u));return l.length?qU(this,l,this.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"):[]}deleteAll(){return qU(this,["!*$_ALL_ENTITIES_!*$"],this.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})}async refreshAllStaleEntities(a){return await this.oJ(a)}setUpPositionSyncInterval(a){this.V!==
void 0&&(g.mW(this.V),this.V=void 0);const l=a??864E5;this.V=g.tl(()=>{this.bU(l)},l)}async bU(a){try{const l=await Dm.getInstance();
if(!l)throw Error("prefStorage is undefined");const B=await l.get("psi"),u=B?.CA?Number(B.CA)/1E3:0,V=Date.now();u+a<=V&&await qU(this,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")}catch(l){$W("Offline manager error",l)}}async xV(){var a=await S8();if(!a)return[];var l=await E7(a,"transfer");a=[];for(const B of l)B.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&B.key&&(l=g.iX(B.key).entityId,a.push(l));return Zqv(this,a)}async C(){return[]}async cA(){}async RJ(){}};var VSA=class extends us{constructor(a,l,B){super(a);this.J=a;this.eF=l;this.K=B}Z(a){return RB(a)?gUu(this,a):av(a)?aKE(this,a):lC(a)?lKu(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},x_=[10];var bcv=class extends us{constructor(a,l,B){super(a);this.J=a;this.eF=l;this.K=B}Z(a){return RB(a)?nf_(this,a):av(a)?ejp(this,a):lC(a)?MAX(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},s7u=[10];var Q1p=class extends us{constructor(a,l,B){super(a);this.J=a;this.eF=l;this.K=B}Z(a){return av(a)?r_n(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}};var s1u=class extends uJu{constructor(){super(...arguments);this.D="mainVideoEntity"}A(a){const l=super.A(a);l.mainVideoEntity=new bcv(a,this.eF,this.J);l.mainPlaylistEntity=new VSA(a,this.eF,this.J);l.mainDownloadsListEntity=new Q1p(a,this.eF,this.J);return l}async refreshAllStaleEntities(a,l){let B=[];this.eF.W("web_player_offline_playlist_auto_refresh")&&(B=await YuA(this,a,l));var u=await Dm.getInstance();const V=await u?.get("sdois");u=await u?.get("lmqf");V&&(B=B.concat(await vft(this,V,u??
"SD",a===0)));return B=B.concat(await super.refreshAllStaleEntities(a,l))}async vA(a){var l=await S8();if(!l)return!1;l=await hs(l,fg,"mainDownloadsListEntity");if(l?.downloads?.length){a=g.Om(a,"mainVideoEntity");for(const B of l.downloads)if(B.videoItem===a)return!0}return!1}async C(){var a=await S8();if(!a)return[];var l=await E7(a,"downloadStatusEntity");a=[];for(const B of l)B.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&B.key&&(l=g.iX(B.key).entityId,a.push(l));return a.length?qU(this,a,"mainVideoEntity",
"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}}):[]}async RJ(){const a=await S8();a&&await H7(a,{mode:"readwrite",uA:!0},l=>W7(l,"mainVideoEntity").then(B=>{const u=[];for(const V of B){if(V.userState?.playbackPosition)continue;B=g.iX(V.key).entityId;B={key:g.Om(B,"videoPlaybackPositionEntity"),videoId:B,lastPlaybackPositionSeconds:"0"};u.push(Js(l,B,"videoPlaybackPositionEntity"));V.userState={playbackPosition:B.key};u.push(Js(l,
V,"mainVideoEntity"))}return g.CJ.all(u)}))}async cA(){const a=await S8();
if(a){var l=g.Om("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),B=await H7(a,{mode:"readonly",uA:!0},F=>g.CJ.all([pF(F,l,"mainDownloadsListEntity"),pF(F,fg,"mainDownloadsListEntity"),W7(F,"mainVideoEntity"),W7(F,"mainPlaylistEntity")])),[u,
V,b,Q]=B;B=new Set;if(u?.downloads?.length)for(var n of u.downloads){var e=n.videoItem??n.playlistItem;e&&B.add(e)}if(V?.downloads?.length)for(var M of V.downloads)M.videoItem&&B.add(M.videoItem);n=new Set;M=[];for(var I of Q){if(I.videos)for(const F of I.videos)(e=JSON.parse(g.iX(F).entityId).videoId)&&n.add(e);I.key&&!B.has(I.key)&&M.push(I.key)}for(const F of b)F.key&&!B.has(F.key)&&(I=g.iX(F.key).entityId,n.has(I)||M.push(F.key));M.length&&await Lg(a,M)}}};var nRt=class extends us{constructor(a,l){super(a);this.J=a;this.K=l}Z(a){return RB(a)?Nmt(this,a):av(a)?fKo(this,a):lC(a)?Lno(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},gg=[10];var eIt=class extends us{constructor(a,l){super(a);this.J=a;this.K=l}Z(a){return RB(a)?c_r(this,a):av(a)?peE(this,a):lC(a)?Wnp(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},Rv=[10];var MSX=class extends us{constructor(a,l){super(a);this.J=a;this.K=l}Z(a){return RB(a)?O_u(this,a):av(a)?Tmu(this,a):lC(a)?H_E(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},i_e=[10];var I7N=class extends uJu{constructor(){super(...arguments);this.D="musicTrack"}A(a){const l=super.A(a);l.musicTrack=new MSX(a,this.J);l.musicPlaylist=new eIt(a,this.J);l.musicAlbumRelease=new nRt(a,this.J);return l}async refreshAllStaleEntities(a,l){let B=await DGv(this,a,l);return B=B.concat(await super.refreshAllStaleEntities(a,l))}};g.P_("offline",class extends g.fP{constructor(){super(...arguments);this.events=new g.B1(this);this.eF=this.player.U();this.Dv={V4q:()=>this.J,
Np:()=>this.Np(),
EA:a=>this.EA(a)}}create(){g.W(this,this.events);
if(g.AT(this.eF))this.J=new s1u(this.eF,this.player);else if(g.a5(this.eF)||g.eK(this.eF))this.J=new I7N(this.eF,this.player);this.events.O(this.player,"onPlaybackStartExternal",()=>{this.Np()});
this.events.O(this.player,"videodatachange",()=>{this.Np()});
this.eF.W("html5_offline_playback_position_sync")&&this.events.O(this.player,"presentingplayerstatechange",this.EA)}Wv(){return!1}async cq(a,l,B,u){return this.J?qU(this.J,a,l,B,u):Promise.reject()}deleteAll(){return this.J.deleteAll()}oJ(a){return this.J.oJ(a)}refreshAllStaleEntities(a){return this.J.refreshAllStaleEntities(a)}setUpPositionSyncInterval(a){this.J.setUpPositionSyncInterval(a)}BZ(a){this.J.BZ(a)}UG(a){return this.J.UG(a)}async Np(){const a=this.player.getVideoData();a.lA()&&hjt(a)&&
this.Z!==a.clientPlaybackNonce&&await Efp(this,a)}async EA(a){var l=this.player.getVideoData();const B=l.Wu;if(a.vR(2)||a.vR(512))(a=await S8())?(l=l.videoId,await hs(a,g.Om(l,"mainVideoEntity"),"mainVideoEntity")&&await this.cq([l],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",{videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:Math.floor(B).toString()}})):$W("PES is undefined")}isOrchestrationLeader(){return this.J.isOrchestrationLeader()}async updateDownloadState(a,
l){const B=await S8();if(B){var {entityType:u,entityId:V}=g.iX(a);await BU(V,u,B,l,!0)}else $W("PES is undefined")}});})(_yt_player);
